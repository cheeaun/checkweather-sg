parcelRequire=function(e,r,n){var t="function"==typeof parcelRequire&&parcelRequire,i="function"==typeof require&&require;function u(n,o){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!o&&f)return f(n,!0);if(t)return t(n,!0);if(i&&"string"==typeof n)return i(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}a.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,a,l,l.exports)}return r[n].exports;function a(e){return u(a.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=t;for(var o=0;o<n.length;o++)u(n[o]);return u}({11:[function(require,module,exports) {
module.exports="/arrow-down.21ca6b65.png";
},{}],12:[function(require,module,exports) {
const e=Math.cos,t=Math.sin,r=Math.sqrt,l=Math.PI,n={km:6371,mile:3960,meter:6371e3,nmi:3440},o={getLatitudeBounds(e,t,r){r||(r="meter"),0===arguments.length&&(()=>{throw new Error("Please fill in all arguments")})();let o=t/(2*l/360*n[r]);return{lowerLat:e-o,upperLat:e+o}},getLongitudeBounds(t,r,o,a){a||(a="meter"),0===arguments.length&&(()=>{throw new Error("Please fill in all arguments")})();let s=o/(2*l/360*n[a]*e(t*l/180));return{lowerLong:r-s,upperLong:r+s}}};module.exports=o;
},{}],7:[function(require,module,exports) {
"use strict";var t=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,o=!1,a=void 0;try{for(var r,l=t[Symbol.iterator]();!(n=(r=l.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=require("./assets/arrow-down.png"),n=r(i),o=require("new-point-haversine"),a=r(o);function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=[103.972583,1.34911],c=a.default.getLatitudeBounds(s[1],70,"km"),u=c.lowerLat,d=c.upperLat,p=a.default.getLongitudeBounds(s[1],s[0],70,"km"),m=p.lowerLong,f=p.upperLong;mapboxgl.accessToken="pk.eyJ1IjoiY2hlZWF1biIsImEiOiIwMTkyNjRiOWUzOTMyZThkYTE3YjMyMWFiZGU2OTZlNiJ9.XsOEKtyctGiNGNsmVhetYg",window.$map&&window.$map.remove();var h=window.$map=new mapboxgl.Map({container:"map",maxBounds:[m,u,f,d],style:"mapbox://styles/mapbox/dark-v9?optimize=true",logoPosition:"top-right",maxZoom:14,renderWorldCopies:!1,boxZoom:!1,attributionControl:!1}),y=[103.821842,1.349139];h.setCenter(y),h.addControl(new mapboxgl.AttributionControl({compact:!0}),"top-right"),h.addControl(new mapboxgl.NavigationControl,"top-right"),h.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}));var g=function(){function t(){l(this,t)}return e(t,[{key:"onAdd",value:function(t){this._map=t;var e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group",e.innerHTML='<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-custom-pitch" type="button"><span>3D</span></button>',e.onclick=function(){var e=t.getPitch(),i=0;e<30?i=30:e<45?i=45:e<60&&(i=60),t.easeTo({pitch:i})},t.on("pitchend",this.onPitch.bind(this)),this._container=e,this._container}},{key:"onPitch",value:function(){var t=this._map.getPitch();this._container.classList.toggle("active",!!t),this._container.getElementsByTagName("span")[0].style.transform="rotate3d(1,0,0,"+t+"deg)"}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map.off("pitchend",this.onPitch.bind(this)),this._map=void 0}}]),t}();h.addControl(new g,"top-right");var v=!1,b=function(){function t(){l(this,t)}return e(t,[{key:"onAdd",value:function(t){this._map=t;var e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group",e.innerHTML='<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-custom-clouds-mode" type="button">\n      <svg viewBox="0 0 640 512">\n        <path d="M537.585 226.56C541.725 215.836 544 204.184 544 192c0-53.019-42.981-96-96-96-19.729 0-38.065 5.954-53.316 16.159C367.042 64.248 315.288 32 256 32c-88.366 0-160 71.634-160 160 0 2.728.07 5.439.204 8.133C40.171 219.845 0 273.227 0 336c0 79.529 64.471 144 144 144h368c70.692 0 128-57.308 128-128 0-61.93-43.983-113.586-102.415-125.44z"/>\n      </svg>\n    </button>',e.onclick=function(){if(v=!v,e.classList.toggle("active",v),document.body.classList.toggle("cloud-mode",v),v)t.setLayoutProperty("rain3d","visibility","none"),t.setLayoutProperty("rainlay","visibility","none"),t.setLayoutProperty("rainclouds","visibility","visible"),t.setLayoutProperty("raincloudshadows","visibility","visible"),t.easeTo({pitch:60});else{var i=t.getPitch();t.setLayoutProperty("rain3d","visibility",i>0?"visible":"none"),t.setLayoutProperty("rainlay","visibility",i>0?"none":"visible"),t.setLayoutProperty("rainclouds","visibility","none"),t.setLayoutProperty("raincloudshadows","visibility","none")}},this._container=e,this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}}]),t}();h.addControl(new b,"top-right");var w=document.getElementById("legend");h.on("movestart",function(){return w.classList.add("faded")}),h.on("moveend",function(){return w.classList.remove("faded")});var x=function(){return 5*Math.floor((new Date).getMinutes()/5)},L={},P=function(t){return t.metadata.stations.forEach(function(t){if(!L[t.id]){var e=t.location,i=e.latitude,n=e.longitude;L[t.id]=[n,i]}}),{type:"FeatureCollection",features:t.items[0].readings.map(function(t){return{type:"Feature",properties:{reading:t.value},geometry:{type:"Point",coordinates:L[t.station_id]}}})}},M=void 0,z={rain:"https://api.checkweather.sg/now",rainfall:"https://api.data.gov.sg/v1/environment/rainfall",temp:"https://api.data.gov.sg/v1/environment/air-temperature",humid:"https://api.data.gov.sg/v1/environment/relative-humidity",wind:"https://api.data.gov.sg/v1/environment/wind-direction"},k=function(){var t=x();if(M!==t){M=t,console.log("UM",M);var e=h.getSource("rainsource");if(e)e.setData(z.rain),fetch(z.rainfall).then(function(t){return t.json()}).then(function(t){h.getSource("rainmm").setData(P(t))}).catch(function(t){return t});else{h.addSource("rainsource",{type:"geojson",data:z.rain}),h.addLayer({id:"rainlay",type:"fill",source:"rainsource",paint:{"fill-color":["get","color"],"fill-antialias":!1,"fill-opacity":["interpolate",["linear"],["zoom"],8,.9,14,["*",["/",["get","intensity"],100],.3]]}},T),h.addLayer({id:"rain3d",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],8,.9,14,.1],"fill-extrusion-height":["*",50,["get","intensity"]]}},T),h.addLayer({id:"rainclouds",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-color":"#fff","fill-extrusion-opacity":.8,"fill-extrusion-height":["+",5200,["*",5,["get","intensity"]]],"fill-extrusion-base":5e3}}),h.addLayer({id:"raincloudshadows",type:"fill",source:"rainsource",layout:{visibility:"none"},paint:{"fill-antialias":!1,"fill-opacity":["interpolate",["linear"],["zoom"],8,1,14,["/",["get","intensity"],100]]}});var i=-1;h.on("pitchend",function(){var t=h.getPitch();t!==i&&(i=t,v||(h.setLayoutProperty("rain3d","visibility",t>0?"visible":"none"),h.setLayoutProperty("rainlay","visibility",t>0?"none":"visible")))}),fetch(z.rainfall).then(function(t){return t.json()}).then(function(t){h.addSource("rainmm",{type:"geojson",data:P(t)}),h.addLayer({id:"rainreadings",type:"symbol",source:"rainmm",filter:["!=","reading",0],layout:{"text-field":"{reading}","text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["*",1.5,["zoom"]]]},paint:{"text-color":"aqua","text-halo-color":"#000","text-halo-width":1}},"rainclouds")})}}},C=function(){h.getSource("temp")?Promise.all([fetch(z.temp),fetch(z.humid),fetch(z.wind)]).then(function(t){return Promise.all(t.map(function(t){return t.json()}))}).then(function(e){var i=t(e,3),n=i[0],o=i[1],a=i[2];h.getSource("temp").setData(P(n)),h.getSource("humid").setData(P(o)),h.getSource("wind").setData(P(a))}).catch(function(t){return t}):Promise.all([fetch(z.temp),fetch(z.humid),fetch(z.wind)]).then(function(t){return Promise.all(t.map(function(t){return t.json()}))}).then(function(e){var i=t(e,3),o=i[0],a=i[1],r=i[2];h.addSource("temp",{type:"geojson",data:P(o)}),h.addLayer({id:"tempreadings",type:"symbol",source:"temp",filter:["!=","reading",0],layout:{"text-field":"{reading}Â°","text-allow-overlap":!0,"text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["*",1.5,["zoom"]]],"text-padding":1},paint:{"text-color":"yellow","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),h.addSource("humid",{type:"geojson",data:P(a)}),h.addLayer({id:"humidreadings",type:"symbol",source:"humid",minzoom:10,filter:["!=","reading",0],layout:{"text-field":"{reading}%","text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["zoom"]],"text-offset":[0,-1],"text-padding":0},paint:{"text-color":"orange","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),h.addSource("wind",{type:"geojson",data:P(r)}),h.loadImage(n.default,function(t,e){if(t)throw t;h.addImage("arrow",e,{sdf:!0}),h.addLayer({id:"windirections",type:"symbol",source:"wind",layout:{"icon-image":"arrow","icon-rotate":["get","reading"],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map","icon-size":["interpolate",["linear"],["zoom"],8,.4,14,3]},paint:{"icon-color":"#fff","icon-opacity":.2}},"tempreadings")})}).catch(function(t){return t})},_=function(t,e){var i=void 0,n=function(){return requestAnimationFrame(function(){t(),a()})},o=function(){return clearTimeout(i)},a=function(){o(),i=setTimeout(n,e)};return{start:n,stop:o}},T=void 0;h.on("load",function(){for(var t=h.getStyle().layers,e=0;e<t.length;e++)if("symbol"===t[e].type&&t[e].layout["text-field"]){T=t[e].id;break}_(k,12e4).start(),_(C,6e4).start()});var j=Math.PI/180;function S(t,e,i){var n=e?e*j:0,o=i?i*j:0,a=t?t*j:0,r=(Math.cos(n),Math.cos(o)),l=Math.cos(a),s=Math.sin(n),c=Math.sin(o),u=Math.sin(a),d=-l*c-u*s*r,p=-u*c+l*s*r,m=Math.atan(d/p);return p<0?m+=Math.PI:d<0&&(m+=2*Math.PI),m*(180/Math.PI)}var E=document.getElementById("wind-compass");if(window.DeviceOrientationEvent){var I="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(I,function(t){if(t&&null!==t.alpha){var e=t.compassHeading||t.webkitCompassHeading||S(t.alpha,t.beta,t.gamma);E.classList.add("compassing"),E.style.transform="rotate("+(e-180)+"deg)"}},!1)}
},{"./assets/arrow-down.png":11,"new-point-haversine":12}]},{},[7])
//# sourceMappingURL=/app.50754f68.map