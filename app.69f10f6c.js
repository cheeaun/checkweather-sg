parcelRequire=function(e,r,n,t){function i(n,t){function o(e){return i(o.resolve(e))}function c(r){return e[n][1][r]||r}if(!r[n]){if(!e[n]){var l="function"==typeof parcelRequire&&parcelRequire;if(!t&&l)return l(n,!0);if(u)return u(n,!0);if(f&&"string"==typeof n)return f(n);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}o.resolve=c;var a=r[n]=new i.Module(n);e[n][0].call(a.exports,o,a,a.exports,this)}return r[n].exports}function o(e){this.id=e,this.bundle=i,this.exports={}}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;i.isParcelRequire=!0,i.Module=o,i.modules=e,i.cache=r,i.parent=u;for(var c=0;c<n.length;c++)i(n[c]);if(n.length){var l=i(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):t&&(this[t]=l)}return i}({7:[function(require,module,exports) {
module.exports="/arrow-down.21ca6b65.png";
},{}],8:[function(require,module,exports) {
module.exports="/rain.6dc4bda6.png";
},{}],3:[function(require,module,exports) {
"use strict";var t=function(){function t(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(i,e,o){return e&&t(i.prototype,e),o&&t(i,o),i}}(),i=require("./assets/arrow-down.png"),e=a(i),o=require("./assets/rain.png"),n=a(o);function a(t){return t&&t.__esModule?t:{default:t}}function r(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var l=[103.8475,1.3011],s=1.156,c=1.475,d=103.565,u=104.13;mapboxgl.accessToken="pk.eyJ1IjoiY2hlZWF1biIsImEiOiIwMTkyNjRiOWUzOTMyZThkYTE3YjMyMWFiZGU2OTZlNiJ9.XsOEKtyctGiNGNsmVhetYg",window.$map&&window.$map.remove();var p=window.$map=new mapboxgl.Map({container:"map",center:l,style:"mapbox://styles/mapbox/dark-v9?optimize=true",logoPosition:"top-right",minZoom:8,maxZoom:14,renderWorldCopies:!1,boxZoom:!1,attributionControl:!1});p.fitBounds([d,s,u,c],{animate:!1,padding:window.innerWidth>480&&window.innerHeight>480?120:0}),p.addControl(new mapboxgl.AttributionControl({compact:!0}),"top-right"),p.addControl(new mapboxgl.NavigationControl,"top-right"),p.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}));var m=function(){function i(){r(this,i)}return t(i,[{key:"onAdd",value:function(t){this._map=t;var i=document.createElement("div");return i.className="mapboxgl-ctrl mapboxgl-ctrl-group",i.innerHTML='<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-custom-pitch" type="button"><span>3D</span></button>',i.onclick=function(){var i=t.getPitch(),e=0;i<30?e=30:i<45?e=45:i<60&&(e=60),t.easeTo({pitch:e})},t.on("pitchend",this.onPitch.bind(this)),this._container=i,this._container}},{key:"onPitch",value:function(){var t=this._map.getPitch();this._container.classList.toggle("active",!!t),this._container.getElementsByTagName("span")[0].style.transform="rotate3d(1,0,0,"+t+"deg)"}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map.off("pitchend",this.onPitch.bind(this)),this._map=void 0}}]),i}();p.addControl(new m,"top-right");var y=!1,f=function(){function i(){r(this,i)}return t(i,[{key:"onAdd",value:function(t){this._map=t;var i=document.createElement("div");return i.className="mapboxgl-ctrl mapboxgl-ctrl-group",i.innerHTML='<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-custom-clouds-mode" type="button">\n      <svg viewBox="0 0 640 512">\n        <path d="M537.585 226.56C541.725 215.836 544 204.184 544 192c0-53.019-42.981-96-96-96-19.729 0-38.065 5.954-53.316 16.159C367.042 64.248 315.288 32 256 32c-88.366 0-160 71.634-160 160 0 2.728.07 5.439.204 8.133C40.171 219.845 0 273.227 0 336c0 79.529 64.471 144 144 144h368c70.692 0 128-57.308 128-128 0-61.93-43.983-113.586-102.415-125.44z"/>\n      </svg>\n    </button>',i.onclick=function(){if(y=!y,i.classList.toggle("active",y),document.body.classList.toggle("cloud-mode",y),y)t.setLayoutProperty("rain3d","visibility","none"),t.setLayoutProperty("rainlay","visibility","none"),t.setLayoutProperty("rainclouds","visibility","visible"),t.setLayoutProperty("raindrops","visibility","visible"),t.setLayoutProperty("raincloudshadows","visibility","visible"),t.easeTo({pitch:60});else{var e=t.getPitch();t.setLayoutProperty("rain3d","visibility",e>0?"visible":"none"),t.setLayoutProperty("rainlay","visibility",e>0?"none":"visible"),t.setLayoutProperty("rainclouds","visibility","none"),t.setLayoutProperty("raindrops","visibility","none"),t.setLayoutProperty("raincloudshadows","visibility","none")}},this._container=i,this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}}]),i}();p.addControl(new f,"top-right");var h=document.getElementById("legend");p.on("movestart",function(){return h.classList.add("faded")}),p.on("moveend",function(){return h.classList.remove("faded")});var v=function(){return 5*Math.floor((new Date).getMinutes()/5)},g={},b=function(t){return t.metadata.stations.forEach(function(t){if(!g[t.id]){var i=t.location,e=i.latitude,o=i.longitude;g[t.id]=[o,e]}}),{type:"FeatureCollection",features:t.items[0].readings.map(function(t){return{type:"Feature",properties:{reading:t.value},geometry:{type:"Point",coordinates:g[t.station_id]}}})}},x="https://api.checkweather.sg",w={rain:x+"/now",id:x+"/now-id",observations:x+"/observations?compact=1"},L=document.getElementById("datetime"),_=document.getElementById("loader");p.on("dataloading",function(t){_.hidden=!1,L.hidden=!0}),p.on("data",function(t){_.hidden=!0,L.hidden=!1});var P=function(){var t=p.getSource("rainsource");if(t)t.setData(w.rain);else{p.addSource("rainsource",{type:"geojson",data:w.rain}),p.addLayer({id:"rainlay",type:"fill",source:"rainsource",paint:{"fill-color":["get","color"],"fill-antialias":!1,"fill-opacity":["interpolate",["linear"],["zoom"],8,["max",.3,["*",["/",["get","intensity"],100],1]],14,["max",.05,["*",["/",["get","intensity"],100],.3]]]}},k),p.addLayer({id:"rain3d",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],8,.7,14,.1],"fill-extrusion-height":["*",50,["get","intensity"]]}},k),p.addLayer({id:"rainclouds",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-color":"#fff","fill-extrusion-opacity":.8,"fill-extrusion-height":["+",5200,["*",5,["get","intensity"]]],"fill-extrusion-base":5e3}}),p.loadImage(n.default,function(t,i){if(t)throw t;p.addImage("rain",i),p.addLayer({id:"raindrops",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-pattern":"rain","fill-extrusion-height":5e3,"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],12,.2,14,.03]}},"rainclouds"),p.addLayer({id:"raincloudshadows",type:"fill",source:"rainsource",layout:{visibility:"none"},paint:{"fill-antialias":!1,"fill-opacity":["interpolate",["linear"],["zoom"],8,.5,14,["*",["/",["get","intensity"],100],.5]]}},"raindrops")});var i=-1;p.on("pitchend",function(){var t=p.getPitch();t!==i&&(i=t,y||(p.setLayoutProperty("rain3d","visibility",t>0?"visible":"none"),p.setLayoutProperty("rainlay","visibility",t>0?"none":"visible")))})}setTimeout(function(){fetch(w.id).then(function(t){return t.text()}).then(function(t){var i=(t.match(/\d{4}$/)||[""])[0].replace(/(\d{2})(\d{2})/,function(t,i,e){var o=parseInt(i,10),n=o>=12?"PM":"AM";return 0==o&&(o=12),o>12&&(o-=12),o+"<blink>:</blink>"+e+" "+n});L.innerHTML=i})},1e3)},M=function(){var t=p.getSource("observations");t?t.setData(w.observations):(p.addSource("observations",{type:"geojson",data:w.observations}),p.addLayer({id:"tempreadings",type:"symbol",source:"observations",filter:["all",["has","temp_celcius"],[">","temp_celcius",0]],layout:{"text-field":"{temp_celcius}Â°","text-allow-overlap":!0,"text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["*",1.5,["zoom"]]],"text-padding":1},paint:{"text-color":"yellow","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),p.addLayer({id:"humidreadings",type:"symbol",source:"observations",minzoom:10,filter:["all",["has","relative_humidity"],[">","relative_humidity",0]],layout:{"text-field":"{relative_humidity}%","text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["zoom"]],"text-offset":[0,-1.1],"text-padding":0},paint:{"text-color":"orange","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),p.addLayer({id:"rainreadings",type:"symbol",source:"observations",minzoom:12,filter:["all",["has","rain_mm"],[">","rain_mm",0]],layout:{"text-field":"{rain_mm}","text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["zoom"]],"text-offset":[0,1.1],"text-padding":0},paint:{"text-color":"aqua","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),p.loadImage(e.default,function(t,i){t||(p.addImage("arrow",i,{sdf:!0}),setTimeout(function(){p.addLayer({id:"windirections",type:"symbol",source:"observations",filter:["has","wind_direction"],layout:{"icon-image":"arrow","icon-rotate":["get","wind_direction"],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map","icon-size":["interpolate",["linear"],["zoom"],8,.4,14,3]},paint:{"icon-color":"#fff","icon-opacity":.2}},"tempreadings")},300))}))},z=function(t,i){var e=void 0,o=function(){return requestAnimationFrame(function(){t(),a()})},n=function(){return clearTimeout(e)},a=function(){n(),e=setTimeout(o,i)};return{start:o,stop:n}},k=void 0;p.on("load",function(){for(var t=p.getStyle().layers,i=0;i<t.length;i++)if("symbol"===t[i].type&&t[i].layout["text-field"]){k=t[i].id;break}p.addLayer({id:"bbox",type:"fill",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-180,90],[180,90],[180,-90],[-180,-90],[-180,90]],[[d,c],[u,c],[u,s],[d,s],[d,c]]]}}},paint:{"fill-color":"rgba(0,0,0,.5)"}},k),z(P,6e4).start(),z(M,12e4).start()});var C=Math.PI/180;function I(t,i,e){var o=i?i*C:0,n=e?e*C:0,a=t?t*C:0,r=(Math.cos(o),Math.cos(n)),l=Math.cos(a),s=Math.sin(o),c=Math.sin(n),d=Math.sin(a),u=-l*c-d*s*r,p=-d*c+l*s*r,m=Math.atan(u/p);return p<0?m+=Math.PI:u<0&&(m+=2*Math.PI),m*(180/Math.PI)}var T=document.getElementById("wind-compass");if(window.DeviceOrientationEvent){var E="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(E,function(t){if(t&&null!==t.alpha){var i=t.compassHeading||t.webkitCompassHeading||I(t.alpha,t.beta,t.gamma);T.classList.add("compassing"),T.style.transform="rotate("+(i-180)+"deg)"}},!1)}
},{"./assets/arrow-down.png":7,"./assets/rain.png":8}]},{},[3], null)
//# sourceMappingURL=/app.0c7e6437.map