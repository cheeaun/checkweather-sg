{"version":3,"sources":["app.js"],"names":["center","lowerLat","upperLat","lowerLong","upperLong","mapboxgl","accessToken","window","$map","remove","map","Map","container","style","logoPosition","minZoom","maxZoom","renderWorldCopies","boxZoom","attributionControl","fitBounds","animate","padding","innerWidth","innerHeight","addControl","AttributionControl","compact","NavigationControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","PitchControl","_map","document","createElement","className","innerHTML","onclick","pitch","getPitch","nextPitch","easeTo","on","onPitch","bind","_container","classList","toggle","text","getElementsByTagName","transform","parentNode","removeChild","off","undefined","cloudsMode","CloudsModeControl","body","setLayoutProperty","$legend","getElementById","add","uniqMinute","Math","floor","Date","getMinutes","stationsMap","genReadingsGeoJSON","data","metadata","stations","forEach","station","id","location","latitude","longitude","type","features","items","readings","properties","reading","value","geometry","coordinates","station_id","HOST","sources","rain","observations","$datetime","$loader","e","hidden","showRain","rainSource","getSource","setData","addSource","addLayer","source","paint","labelLayerId","layout","visibility","loadImage","rainDrops","image","addImage","currentPitch","setTimeout","fetch","then","res","html","match","replace","m","m1","m2","h","parseInt","ampm","showObservations","observationsSource","filter","minzoom","arrowPath","sdf","rafInterval","fn","delay","rafint","start","requestAnimationFrame","fnTimeout","stop","clearTimeout","layers","getStyle","i","length","degtorad","PI","compassHeading","alpha","beta","gamma","_x","_y","_z","cX","cos","cY","cZ","sX","sin","sY","sZ","Vx","Vy","atan","$windCompasss","DeviceOrientationEvent","deviceorientation","addEventListener","heading","webkitCompassHeading"],"mappings":"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","file":"app.0c7e6437.map","sourceRoot":"..","sourcesContent":["import arrowPath from './assets/arrow-down.png';\nimport rainDrops from './assets/rain.png';\n\nconst center = [103.8475, 1.3011];\nconst lowerLat = 1.156, upperLat = 1.475, lowerLong = 103.565, upperLong = 104.130;\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiY2hlZWF1biIsImEiOiIwMTkyNjRiOWUzOTMyZThkYTE3YjMyMWFiZGU2OTZlNiJ9.XsOEKtyctGiNGNsmVhetYg';\nif (window.$map) window.$map.remove();\nconst map = window.$map = new mapboxgl.Map({\n  container: 'map',\n  center,\n  style: 'mapbox://styles/mapbox/dark-v9?optimize=true',\n  logoPosition: 'top-right',\n  minZoom: 8,\n  maxZoom: 14,\n  renderWorldCopies: false,\n  boxZoom: false,\n  attributionControl: false,\n});\nmap.fitBounds([lowerLong, lowerLat, upperLong, upperLat], {\n  animate: false,\n  padding: window.innerWidth > 480 && window.innerHeight > 480 ? 120 : 0,\n});\n\n// Controls\nmap.addControl(new mapboxgl.AttributionControl({\n  compact: true\n}), 'top-right');\nmap.addControl(new mapboxgl.NavigationControl(), 'top-right');\nmap.addControl(new mapboxgl.GeolocateControl({\n  positionOptions: {\n    enableHighAccuracy: true,\n  },\n  trackUserLocation: true,\n}));\n\n// Pitch control\nclass PitchControl {\n  onAdd(map) {\n    this._map = map;\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n    container.innerHTML = '<button class=\"mapboxgl-ctrl-icon mapboxgl-ctrl-custom-pitch\" type=\"button\"><span>3D</span></button>';\n    container.onclick = function(){\n      var pitch = map.getPitch();\n      var nextPitch = 0;\n      if (pitch < 30) {\n        nextPitch = 30;\n      } else if (pitch < 45) {\n        nextPitch = 45;\n      } else if (pitch < 60) {\n        nextPitch = 60;\n      }\n      map.easeTo({ pitch: nextPitch });\n    };\n    map.on('pitchend', this.onPitch.bind(this));\n    this._container = container;\n    return this._container;\n  }\n  onPitch() {\n    const pitch = this._map.getPitch();\n    this._container.classList.toggle('active', !!pitch);\n    const text = this._container.getElementsByTagName('span')[0];\n    text.style.transform = 'rotate3d(1,0,0,' + pitch + 'deg)';\n  }\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map.off('pitchend', this.onPitch.bind(this));\n    this._map = undefined;\n  }\n};\nmap.addControl(new PitchControl(), 'top-right');\n\n// Clouds Mode control\nlet cloudsMode = false;\nclass CloudsModeControl {\n  onAdd(map) {\n    this._map = map;\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n    container.innerHTML = `<button class=\"mapboxgl-ctrl-icon mapboxgl-ctrl-custom-clouds-mode\" type=\"button\">\n      <svg viewBox=\"0 0 640 512\">\n        <path d=\"M537.585 226.56C541.725 215.836 544 204.184 544 192c0-53.019-42.981-96-96-96-19.729 0-38.065 5.954-53.316 16.159C367.042 64.248 315.288 32 256 32c-88.366 0-160 71.634-160 160 0 2.728.07 5.439.204 8.133C40.171 219.845 0 273.227 0 336c0 79.529 64.471 144 144 144h368c70.692 0 128-57.308 128-128 0-61.93-43.983-113.586-102.415-125.44z\"/>\n      </svg>\n    </button>`;\n    container.onclick = function(){\n      cloudsMode = !cloudsMode;\n      container.classList.toggle('active', cloudsMode);\n      document.body.classList.toggle('cloud-mode', cloudsMode);\n      if (cloudsMode){\n        map.setLayoutProperty('rain3d', 'visibility', 'none');\n        map.setLayoutProperty('rainlay', 'visibility', 'none');\n        map.setLayoutProperty('rainclouds', 'visibility', 'visible');\n        map.setLayoutProperty('raindrops', 'visibility', 'visible');\n        map.setLayoutProperty('raincloudshadows', 'visibility', 'visible');\n        map.easeTo({\n          pitch: 60,\n        });\n      } else {\n        const pitch = map.getPitch();\n        map.setLayoutProperty('rain3d', 'visibility', pitch > 0 ? 'visible' : 'none');\n        map.setLayoutProperty('rainlay', 'visibility', pitch > 0 ? 'none' : 'visible');\n        map.setLayoutProperty('rainclouds', 'visibility', 'none');\n        map.setLayoutProperty('raindrops', 'visibility', 'none');\n        map.setLayoutProperty('raincloudshadows', 'visibility', 'none');\n      }\n    };\n    this._container = container;\n    return this._container;\n  }\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n  }\n}\nmap.addControl(new CloudsModeControl(), 'top-right');\n\n// Fade out the legend when interacting on the map\nconst $legend = document.getElementById('legend');\nmap.on('movestart', () => $legend.classList.add('faded'));\nmap.on('moveend', () => $legend.classList.remove('faded'));\n\nconst uniqMinute = () => {\n  return Math.floor((new Date()).getMinutes()/5)*5;\n};\n\nconst stationsMap = {};\nconst genReadingsGeoJSON = (data) => {\n  data.metadata.stations.forEach(station => {\n    if (stationsMap[station.id]) return;\n    const { latitude, longitude } = station.location;\n    stationsMap[station.id] = [longitude, latitude];\n  });\n  return {\n    type: 'FeatureCollection',\n    features: data.items[0].readings.map(reading => {\n      return {\n        type: 'Feature',\n        properties: {\n          reading: reading.value,\n        },\n        geometry: {\n          type: 'Point',\n          coordinates: stationsMap[reading.station_id],\n        },\n      }\n    }),\n  };\n}\n\nconst HOST = 'https://api.checkweather.sg';\nconst sources = {\n  rain: HOST + '/now',\n  id: HOST + '/now-id',\n  observations: HOST + '/observations?compact=1',\n};\n\nconst $datetime = document.getElementById('datetime');\n\nconst $loader = document.getElementById('loader');\nmap.on('dataloading', (e) => {\n  $loader.hidden = false;\n  $datetime.hidden = true;\n});\nmap.on('data', (e) => {\n  $loader.hidden = true;\n  $datetime.hidden = false;\n});\n\nconst showRain = () => {\n  const rainSource = map.getSource('rainsource');\n  if (rainSource){\n    rainSource.setData(sources.rain);\n  } else {\n    map.addSource('rainsource', {\n      type: 'geojson',\n      data: sources.rain,\n    });\n\n    // 2D radar\n    map.addLayer({\n      id: 'rainlay',\n      type: 'fill',\n      source: 'rainsource',\n      paint: {\n        'fill-color': ['get', 'color'],\n        'fill-antialias': false,\n        // 'fill-outline-color': 'black',\n        'fill-opacity': [\n          'interpolate', ['linear'], ['zoom'],\n          8, ['max', .3, ['*', ['/', ['get', 'intensity'], 100], 1]],\n          14, ['max', .05, ['*', ['/', ['get', 'intensity'], 100], .3]]\n        ],\n      },\n    }, labelLayerId);\n\n    // 3D radar\n    map.addLayer({\n      id: 'rain3d',\n      type: 'fill-extrusion',\n      source: 'rainsource',\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-extrusion-color': ['get', 'color'],\n        'fill-extrusion-opacity': [\n          'interpolate', ['linear'], ['zoom'],\n          8, .7,\n          14, .1\n        ],\n        'fill-extrusion-height': ['*', 50, ['get', 'intensity']],\n      },\n    }, labelLayerId);\n\n    // 3D clouds\n    map.addLayer({\n      id: 'rainclouds',\n      type: 'fill-extrusion',\n      source: 'rainsource',\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-extrusion-color': '#fff',\n        'fill-extrusion-opacity': .8,\n        'fill-extrusion-height': ['+', 5200, ['*', 5, ['get', 'intensity']]],\n        'fill-extrusion-base': 5000,\n      },\n    });\n    map.loadImage(rainDrops, (e, image) => {\n      if (e) throw e;\n      map.addImage('rain', image);\n      map.addLayer({\n        id: 'raindrops',\n        type: 'fill-extrusion',\n        source: 'rainsource',\n        layout: {\n          visibility: 'none',\n        },\n        paint: {\n          'fill-extrusion-pattern': 'rain',\n          'fill-extrusion-height': 5000,\n          'fill-extrusion-opacity': [\n            'interpolate', ['linear'], ['zoom'],\n            12, .2,\n            14, .03\n          ],\n        },\n      }, 'rainclouds');\n      map.addLayer({\n        id: 'raincloudshadows',\n        type: 'fill',\n        source: 'rainsource',\n        layout: {\n          visibility: 'none',\n        },\n        paint: {\n          'fill-antialias': false,\n          'fill-opacity': [\n            'interpolate', ['linear'], ['zoom'],\n            8, .5,\n            14, ['*', ['/', ['get', 'intensity'], 100], .5]\n          ],\n        },\n      }, 'raindrops');\n    });\n\n    let currentPitch = -1;\n    map.on('pitchend', () => {\n      const pitch = map.getPitch();\n      if (pitch === currentPitch) return;\n      currentPitch = pitch;\n      if (cloudsMode) return;\n      map.setLayoutProperty('rain3d', 'visibility', pitch > 0 ? 'visible' : 'none');\n      map.setLayoutProperty('rainlay', 'visibility', pitch > 0 ? 'none' : 'visible');\n    });\n  }\n\n  setTimeout(() => {\n    fetch(sources.id).then((res) => res.text()).then((id) => {\n      const html = (id.match(/\\d{4}$/) || [''])[0].replace(/(\\d{2})(\\d{2})/, (m, m1, m2) => {\n        let h = parseInt(m1, 10);\n        const ampm = h >= 12 ? 'PM' : 'AM';\n        if (h == 0) h = 12;\n        if (h > 12) h -= 12;\n        return h + '<blink>:</blink>' + m2 + ' ' + ampm;\n      });\n      $datetime.innerHTML = html;\n    });\n  }, 1000);\n};\n\nconst showObservations = () => {\n  const observationsSource = map.getSource('observations');\n  if (observationsSource){\n    observationsSource.setData(sources.observations);\n  } else {\n    map.addSource('observations', {\n      type: 'geojson',\n      data: sources.observations,\n    });\n    map.addLayer({\n      id: 'tempreadings',\n      type: 'symbol',\n      source: 'observations',\n      filter: ['all', ['has', 'temp_celcius'], ['>', 'temp_celcius', 0]],\n      layout: {\n        'text-field': '{temp_celcius}Â°',\n        'text-allow-overlap': true,\n        'text-size': [\n          'interpolate', ['linear'], ['zoom'],\n          8, ['zoom'],\n          14, ['*', 1.5, ['zoom']]\n        ],\n        'text-padding': 1,\n      },\n      paint: {\n        'text-color': 'yellow',\n        'text-halo-color': '#000',\n        'text-halo-width': 1,\n      },\n    }, 'rainclouds');\n    map.addLayer({\n      id: 'humidreadings',\n      type: 'symbol',\n      source: 'observations',\n      minzoom: 10,\n      filter: ['all', ['has', 'relative_humidity'], ['>', 'relative_humidity', 0]],\n      layout: {\n        'text-field': '{relative_humidity}%',\n        'text-size': [\n          'interpolate', ['linear'], ['zoom'],\n          8, ['zoom'],\n          14, ['zoom']\n        ],\n        'text-offset': [0, -1.1],\n        'text-padding': 0,\n      },\n      paint: {\n        'text-color': 'orange',\n        'text-halo-color': '#000',\n        'text-halo-width': 1,\n      },\n    }, 'rainclouds');\n    map.addLayer({\n      id: 'rainreadings',\n      type: 'symbol',\n      source: 'observations',\n      minzoom: 12,\n      filter: ['all', ['has', 'rain_mm'], ['>', 'rain_mm', 0]],\n      layout: {\n        'text-field': '{rain_mm}',\n        'text-size': [\n          'interpolate', ['linear'], ['zoom'],\n          8, ['zoom'],\n          14, ['zoom']\n        ],\n        'text-offset': [0, 1.1],\n        'text-padding': 0,\n      },\n      paint: {\n        'text-color': 'aqua',\n        'text-halo-color': '#000',\n        'text-halo-width': 1,\n      },\n    }, 'rainclouds');\n    map.loadImage(arrowPath, (e, image) => {\n      if (e) return;\n      map.addImage('arrow', image, { sdf: true });\n      setTimeout(() => {\n        map.addLayer({\n          id: 'windirections',\n          type: 'symbol',\n          source: 'observations',\n          filter: ['has', 'wind_direction'],\n          layout: {\n            'icon-image': 'arrow',\n            'icon-rotate': ['get', 'wind_direction'],\n            'icon-allow-overlap': true,\n            'icon-ignore-placement': true,\n            'icon-pitch-alignment': 'map',\n            'icon-rotation-alignment': 'map',\n            'icon-size': [\n              'interpolate', ['linear'], ['zoom'],\n              8, .4,\n              14, 3\n            ],\n          },\n          paint: {\n            'icon-color': '#fff',\n            'icon-opacity': .2,\n          },\n        }, 'tempreadings');\n      }, 300);\n    });\n  }\n}\n\nconst rafInterval = (fn, delay) => {\n  let rafint;\n  const start = () => requestAnimationFrame(() => {\n    fn();\n    fnTimeout();\n  });\n  const stop = () => clearTimeout(rafint);\n  const fnTimeout = () => {\n    stop();\n    rafint = setTimeout(start, delay);\n  }\n  return {\n    start,\n    stop,\n  };\n};\n\nlet labelLayerId;\nmap.on('load', function(){\n  const layers = map.getStyle().layers;\n  // Find the index of the first symbol layer in the map style\n  for (let i=0; i<layers.length; i++){\n    if (layers[i].type === 'symbol' && layers[i].layout['text-field']){\n      labelLayerId = layers[i].id;\n      break;\n    }\n  }\n\n  // Mask the area outside Singapore\n  map.addLayer({\n    id: 'bbox',\n    type: 'fill',\n    source: {\n      type: 'geojson',\n      data: {\n        type: 'Feature',\n        properties: {},\n        geometry: {\n          type: 'Polygon',\n          coordinates: [[\n            [-180, 90], [180, 90], [180, -90], [-180, -90], [-180, 90]\n          ], [\n            [lowerLong, upperLat],\n            [upperLong, upperLat],\n            [upperLong, lowerLat],\n            [lowerLong, lowerLat],\n            [lowerLong, upperLat]\n          ]],\n        },\n      },\n    },\n    paint: {\n      'fill-color': 'rgba(0,0,0,.5)',\n    },\n  }, labelLayerId);\n\n  rafInterval(showRain, 60 * 1000).start(); // every min\n  rafInterval(showObservations, 2 * 60 * 1000).start(); // every 2 mins\n});\n\n// https://stackoverflow.com/a/21829819/20838\n// http://w3c.github.io/deviceorientation/spec-source-orientation.html#worked-example\nconst degtorad = Math.PI / 180; // Degree-to-Radian conversion\nfunction compassHeading(alpha, beta, gamma){\n  var _x = beta  ? beta  * degtorad : 0; // beta value\n  var _y = gamma ? gamma * degtorad : 0; // gamma value\n  var _z = alpha ? alpha * degtorad : 0; // alpha value\n\n  var cX = Math.cos( _x );\n  var cY = Math.cos( _y );\n  var cZ = Math.cos( _z );\n  var sX = Math.sin( _x );\n  var sY = Math.sin( _y );\n  var sZ = Math.sin( _z );\n\n  // Calculate Vx and Vy components\n  var Vx = - cZ * sY - sZ * sX * cY;\n  var Vy = - sZ * sY + cZ * sX * cY;\n\n  // Calculate compass heading\n  var compassHeading = Math.atan( Vx / Vy );\n\n  // Convert compass heading to use whole unit circle\n  if( Vy < 0 ) {\n    compassHeading += Math.PI;\n  } else if( Vx < 0 ) {\n    compassHeading += 2 * Math.PI;\n  }\n\n  return compassHeading * ( 180 / Math.PI ); // Compass Heading (in degrees)\n}\n\nconst $windCompasss = document.getElementById('wind-compass');\nif (window.DeviceOrientationEvent){\n  // https://developers.google.com/web/updates/2016/03/device-orientation-changes\n  // https://stackoverflow.com/a/47870694/20838\n  var deviceorientation = 'ondeviceorientationabsolute' in window ? 'deviceorientationabsolute' : 'deviceorientation';\n  window.addEventListener(deviceorientation, function(e){\n    if (!e || e.alpha === null) return;\n    const heading = e.compassHeading || e.webkitCompassHeading || compassHeading(e.alpha, e.beta, e.gamma);\n    $windCompasss.classList.add('compassing');\n    $windCompasss.style.transform = `rotate(${heading-180}deg)`;\n  }, false);\n}"]}