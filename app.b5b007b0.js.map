{"version":3,"sources":["app.js"],"names":["center","lowerLat","upperLat","lowerLong","upperLong","isImmersive","location","hash","document","body","classList","add","window","mapboxgl","accessToken","$map","remove","map","Map","container","style","logoPosition","minZoom","maxZoom","renderWorldCopies","boxZoom","attributionControl","interactive","maxTileCacheSize","fadeDuration","trackResize","bounds","fitBounds","animate","padding","innerWidth","innerHeight","addControl","AttributionControl","compact","NavigationControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","PitchControl","_map","createElement","className","innerHTML","onclick","pitch","getPitch","nextPitch","easeTo","on","onPitch","bind","_container","toggle","getElementsByTagName","transform","parentNode","removeChild","off","undefined","cloudsMode","CloudsModeControl","setLayoutProperty","$legend","getElementById","HOST","sources","rain","id","observations","$datetime","$loader","e","hidden","dataDone","clearTimeout","setTimeout","loadArrowPathP","Promise","res","rej","loadImage","arrowPath","image","showRainID","fetch","then","text","html","match","replace","m","m1","m2","h","parseInt","ampm","showRain","getSource","setData","showObservations","rafInterval","fn","delay","requestAnimationFrame","once","labelLayerId","addSource","type","data","layers","getStyle","i","length","layout","moveLayer","setPaintProperty","forEach","layer","removeLayer","test","opacity","getPaintProperty","addLayer","source","tolerance","buffer","paint","visibility","rainDrops","addImage","currentPitch","filter","sdf","minzoom","properties","geometry","coordinates","degtorad","Math","PI","compassHeading","alpha","beta","gamma","_x","_y","_z","cY","cos","cZ","sX","sin","sY","sZ","Vx","Vy","atan","$windCompasss","DeviceOrientationEvent","deviceorientation","addEventListener","heading","webkitCompassHeading","navigator","serviceWorker","register","isSafari","vendor","indexOf","ratio","devicePixelRatio","canvas","w","width","screen","height","ctx","getContext","fillStyle","fillRect","icon","Image","onload","aspectRatio","drawImage","head","insertAdjacentHTML","toDataURL","src","iconSVGPath"],"mappings":"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","file":"app.b5b007b0.js","sourceRoot":"..","sourcesContent":["import arrowPath from './assets/arrow-down.png';\nimport rainDrops from './assets/rain.png';\nimport iconSVGPath from './icons/icon-standalone.svg';\n\nconst center = [103.8475, 1.3011];\nconst lowerLat = 1.156, upperLat = 1.475, lowerLong = 103.565, upperLong = 104.130;\n\nconst isImmersive = location.hash == '#immersive';\nif (isImmersive){\n  document.body.classList.add('immersive');\n  // Disable tracking\n  // https://developers.google.com/analytics/devguides/collection/gtagjs/user-opt-out\n  window['ga-disable-UA-23235796-10'] = true;\n}\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiY2hlZWF1biIsImEiOiJjam9weHp6MTUwZThvM3FwM3pjd2J1ZGU5In0.gW0WGZAbconHv5JYwSFI6w';\nif (window.$map) window.$map.remove();\nconst map = window.$map = new mapboxgl.Map({\n  container: 'map',\n  center,\n  style: 'mapbox://styles/mapbox/dark-v10?optimize=true',\n  logoPosition: 'top-right',\n  minZoom: 8,\n  maxZoom: 14,\n  renderWorldCopies: false,\n  boxZoom: false,\n  attributionControl: false,\n  interactive: !isImmersive,\n  maxTileCacheSize: isImmersive ? 0 : null,\n  fadeDuration: isImmersive ? 0 : 300,\n  trackResize: !isImmersive,\n  bounds: [lowerLong, lowerLat, upperLong, upperLat],\n});\nif (!isImmersive) {\n  map.fitBounds([lowerLong, lowerLat, upperLong, upperLat], {\n    animate: false,\n    padding: window.innerWidth > 480 && window.innerHeight > 480 ? 120 : 0,\n  });\n}\n\n// Controls\nif (!isImmersive){\n  map.addControl(new mapboxgl.AttributionControl({\n    compact: true\n  }), 'top-right');\n  map.addControl(new mapboxgl.NavigationControl(), 'top-right');\n  map.addControl(new mapboxgl.GeolocateControl({\n    positionOptions: {\n      enableHighAccuracy: true,\n    },\n    trackUserLocation: true,\n  }));\n}\n\n// Pitch control\nclass PitchControl {\n  onAdd(map) {\n    this._map = map;\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n    container.innerHTML = '<button class=\"mapboxgl-ctrl-icon mapboxgl-ctrl-custom-pitch\" type=\"button\"><span>3D</span></button>';\n    container.onclick = function(){\n      var pitch = map.getPitch();\n      var nextPitch = 0;\n      if (pitch < 30) {\n        nextPitch = 30;\n      } else if (pitch < 45) {\n        nextPitch = 45;\n      } else if (pitch < 60) {\n        nextPitch = 60;\n      }\n      map.easeTo({ pitch: nextPitch });\n    };\n    map.on('pitchend', this.onPitch.bind(this));\n    this._container = container;\n    return this._container;\n  }\n  onPitch() {\n    const pitch = this._map.getPitch();\n    this._container.classList.toggle('active', !!pitch);\n    const text = this._container.getElementsByTagName('span')[0];\n    text.style.transform = 'rotate3d(1,0,0,' + pitch + 'deg)';\n  }\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map.off('pitchend', this.onPitch.bind(this));\n    this._map = undefined;\n  }\n};\nmap.addControl(new PitchControl(), 'top-right');\n\n// Clouds Mode control\nlet cloudsMode = false;\nclass CloudsModeControl {\n  onAdd(map) {\n    this._map = map;\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n    container.innerHTML = `<button class=\"mapboxgl-ctrl-icon mapboxgl-ctrl-custom-clouds-mode\" type=\"button\">\n      <svg viewBox=\"0 0 640 512\">\n        <path d=\"M537.585 226.56C541.725 215.836 544 204.184 544 192c0-53.019-42.981-96-96-96-19.729 0-38.065 5.954-53.316 16.159C367.042 64.248 315.288 32 256 32c-88.366 0-160 71.634-160 160 0 2.728.07 5.439.204 8.133C40.171 219.845 0 273.227 0 336c0 79.529 64.471 144 144 144h368c70.692 0 128-57.308 128-128 0-61.93-43.983-113.586-102.415-125.44z\"/>\n      </svg>\n    </button>`;\n    container.onclick = function(){\n      cloudsMode = !cloudsMode;\n      container.classList.toggle('active', cloudsMode);\n      document.body.classList.toggle('cloud-mode', cloudsMode);\n      if (cloudsMode){\n        map.setLayoutProperty('rain3d', 'visibility', 'none');\n        map.setLayoutProperty('rainlay', 'visibility', 'none');\n        map.setLayoutProperty('rainclouds', 'visibility', 'visible');\n        map.setLayoutProperty('raindrops', 'visibility', 'visible');\n        map.setLayoutProperty('raincloudshadows', 'visibility', 'visible');\n        map.easeTo({\n          pitch: 60,\n        });\n      } else {\n        const pitch = map.getPitch();\n        map.setLayoutProperty('rain3d', 'visibility', pitch > 0 ? 'visible' : 'none');\n        map.setLayoutProperty('rainlay', 'visibility', pitch > 0 ? 'none' : 'visible');\n        map.setLayoutProperty('rainclouds', 'visibility', 'none');\n        map.setLayoutProperty('raindrops', 'visibility', 'none');\n        map.setLayoutProperty('raincloudshadows', 'visibility', 'none');\n      }\n    };\n    this._container = container;\n    return this._container;\n  }\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n  }\n}\nmap.addControl(new CloudsModeControl(), 'top-right');\n\n// Fade out the legend when interacting on the map\nconst $legend = document.getElementById('legend');\nmap.on('movestart', () => $legend.classList.add('faded'));\nmap.on('moveend', () => $legend.classList.remove('faded'));\n\nconst HOST = 'https://api.checkweather.sg';\nconst sources = {\n  rain: HOST + '/now',\n  id: HOST + '/now-id',\n  observations: HOST + '/observations?compact=1',\n};\n\nconst $datetime = document.getElementById('datetime');\n\nconst $loader = document.getElementById('loader');\nmap.on('dataloading', (e) => {\n  $loader.hidden = false;\n  $datetime.hidden = true;\n});\nlet dataDone = null;\nmap.on('data', (e) => {\n  clearTimeout(dataDone);\n  dataDone = setTimeout(() => {\n    $loader.hidden = true;\n    $datetime.hidden = false;\n  }, 500);\n});\n\nconst loadArrowPathP = new Promise((res, rej) => {\n  map.loadImage(arrowPath, (e, image) => {\n    e ? rej(e) : res(image);\n  });\n});\n\nconst showRainID = () => {\n  fetch(sources.id).then((res) => res.text()).then((id) => {\n    const html = (id.match(/\\d{4}$/) || [''])[0].replace(/(\\d{2})(\\d{2})/, (m, m1, m2) => {\n      let h = parseInt(m1, 10);\n      const ampm = h >= 12 ? 'PM' : 'AM';\n      if (h == 0) h = 12;\n      if (h > 12) h -= 12;\n      return h + '<blink>:</blink>' + m2 + ' ' + ampm;\n    });\n    $datetime.innerHTML = html;\n  });\n};\n\nconst showRain = () => {\n  map.getSource('rainsource').setData(sources.rain);\n  showRainID();\n};\n\nconst showObservations = () => {\n  map.getSource('observations').setData(sources.observations);\n}\n\nconst rafInterval = (fn, delay) => {\n  setTimeout(requestAnimationFrame, delay, () => {\n    fn();\n    rafInterval(fn, delay);\n  });\n};\n\nmap.once('styledata', function(){\n  // Add sources\n  map.addSource('rainsource', {\n    type: 'geojson',\n    data: sources.rain,\n  });\n  map.addSource('observations', {\n    type: 'geojson',\n    data: sources.observations,\n  });\n  requestAnimationFrame(showRainID);\n\n  // Clean up\n\n  let labelLayerId;\n  const layers = map.getStyle().layers;\n  // console.log(layers);\n  // Find the index of the first symbol layer in the map style\n  for (let i=0; i<layers.length; i++){\n    if (layers[i].type === 'symbol' && layers[i].layout['text-field']){\n      labelLayerId = layers[i].id;\n      break;\n    }\n  }\n\n  // Make water layer see-through\n  map.moveLayer('water', labelLayerId);\n  map.setPaintProperty('water', 'fill-opacity', .5);\n\n  if (isImmersive){\n    layers.forEach(layer => {\n      if (layer.type === 'symbol' && layer.layout['text-field'] && layer.id !== labelLayerId){\n        map.removeLayer(layer.id);\n      }\n    });\n  } else {\n    setTimeout(() => {\n      const layers = map.getStyle().layers;\n      layers.forEach(layer => {\n        if (layer.type === 'symbol' && layer.layout['text-field'] && /place\\-city/i.test(layer.id)){\n          const opacity = map.getPaintProperty(layer.id, 'text-opacity');\n          if (!opacity || opacity > .5){\n            map.setPaintProperty(layer.id, 'text-opacity', .5);\n          }\n        }\n      });\n    }, 2000);\n\n    $legend.hidden = false;\n  }\n\n  // 2D radar\n  map.addLayer({\n    id: 'rainlay',\n    type: 'fill',\n    source: 'rainsource',\n    tolerance: 1,\n    buffer: 0,\n    paint: {\n      'fill-color': ['get', 'color'],\n      'fill-antialias': false,\n      // 'fill-outline-color': 'black',\n      'fill-opacity': [\n        'interpolate', ['linear'], ['zoom'],\n        8, ['max', .5, ['*', ['/', ['get', 'intensity'], 100], 1]],\n        14, ['max', .1, ['*', ['/', ['get', 'intensity'], 100], .5]]\n      ],\n    },\n  }, 'water');\n\n  if (!isImmersive){\n    // 3D radar\n    map.addLayer({\n      id: 'rain3d',\n      type: 'fill-extrusion',\n      source: 'rainsource',\n      tolerance: 1,\n      buffer: 0,\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-extrusion-color': ['get', 'color'],\n        'fill-extrusion-opacity': [\n          'interpolate', ['linear'], ['zoom'],\n          8, .7,\n          14, .1\n        ],\n        'fill-extrusion-height': ['*', 50, ['get', 'intensity']],\n      },\n    }, 'water');\n\n    // 3D clouds\n    map.addLayer({\n      id: 'rainclouds',\n      type: 'fill-extrusion',\n      source: 'rainsource',\n      tolerance: 1,\n      buffer: 0,\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-extrusion-color': '#fff',\n        'fill-extrusion-opacity': .8,\n        'fill-extrusion-height': ['+', 5200, ['*', 5, ['get', 'intensity']]],\n        'fill-extrusion-base': 5000,\n      },\n    });\n\n    map.loadImage(rainDrops, (e, image) => {\n      map.addImage('rain', image);\n      map.addLayer({\n        id: 'raindrops',\n        type: 'fill-extrusion',\n        source: 'rainsource',\n        tolerance: 1,\n        buffer: 0,\n        layout: {\n          visibility: 'none',\n        },\n        paint: {\n          'fill-extrusion-pattern': 'rain',\n          'fill-extrusion-height': 5000,\n          'fill-extrusion-opacity': [\n            'interpolate', ['linear'], ['zoom'],\n            12, .2,\n            14, .03\n          ],\n        },\n      }, 'rainclouds');\n      map.addLayer({\n        id: 'raincloudshadows',\n        type: 'fill',\n        source: 'rainsource',\n        tolerance: 1,\n        buffer: 0,\n        layout: {\n          visibility: 'none',\n        },\n        paint: {\n          'fill-antialias': false,\n          'fill-opacity': [\n            'interpolate', ['linear'], ['zoom'],\n            8, .5,\n            14, ['*', ['/', ['get', 'intensity'], 100], .5]\n          ],\n        },\n      }, 'raindrops');\n    });\n\n    let currentPitch = -1;\n    map.on('pitchend', () => {\n      const pitch = map.getPitch();\n      if (pitch === currentPitch) return;\n      currentPitch = pitch;\n      if (cloudsMode) return;\n      map.setLayoutProperty('rain3d', 'visibility', pitch > 0 ? 'visible' : 'none');\n      map.setLayoutProperty('rainlay', 'visibility', pitch > 0 ? 'none' : 'visible');\n    });\n  } else {\n    // Dummy 'rainclouds' layer\n    map.addLayer({\n      id: 'rainclouds',\n      source: 'rainsource',\n      tolerance: 1,\n      buffer: 0,\n      type: 'fill',\n      layout: {\n        visibility: 'none',\n      },\n    });\n  }\n\n  map.addLayer({\n    id: 'tempreadings',\n    type: 'symbol',\n    source: 'observations',\n    tolerance: 1,\n    buffer: 0,\n    filter: ['all', ['has', 'temp_celcius'], ['>', 'temp_celcius', 0]],\n    layout: {\n      'text-field': '{temp_celcius}°',\n      'text-allow-overlap': true,\n      'text-ignore-placement': true,\n      'text-size': [\n        'interpolate', ['linear'], ['zoom'],\n        8, ['zoom'],\n        14, ['*', 2, ['zoom']]\n      ],\n      'text-padding': 1,\n    },\n    paint: {\n      'text-color': 'yellow',\n      'text-halo-color': '#000',\n      'text-halo-width': 1.5,\n    },\n  }, 'rainclouds');\n\n  loadArrowPathP.then(image => {\n    map.addImage('arrow', image, { sdf: true });\n    map.addLayer({\n      id: 'windirections',\n      type: 'symbol',\n      source: 'observations',\n      tolerance: 1,\n      buffer: 0,\n      filter: ['has', 'wind_direction'],\n      layout: {\n        'icon-image': 'arrow',\n        'icon-rotate': ['get', 'wind_direction'],\n        'icon-allow-overlap': true,\n        'icon-ignore-placement': true,\n        'icon-pitch-alignment': 'map',\n        'icon-rotation-alignment': 'map',\n        'icon-size': [\n          'interpolate', ['linear'], ['zoom'],\n          8, .3,\n          14, 4\n        ],\n      },\n      paint: {\n        'icon-color': '#fff',\n        'icon-opacity': .3,\n      },\n    }, 'tempreadings');\n  });\n\n  requestAnimationFrame(() => {\n    map.addLayer({\n      id: 'humidreadings',\n      type: 'symbol',\n      source: 'observations',\n      minzoom: 10,\n      tolerance: 1,\n      buffer: 0,\n      filter: ['all', ['has', 'relative_humidity'], ['>', 'relative_humidity', 0]],\n      layout: {\n        'text-field': '{relative_humidity}%',\n        'text-ignore-placement': true,\n        'text-size': [\n          'interpolate', ['linear'], ['zoom'],\n          8, ['zoom'],\n          14, ['*', 1.1, ['zoom']]\n        ],\n        'text-offset': [0, -1.1],\n        'text-padding': 0,\n      },\n      paint: {\n        'text-color': 'orange',\n        'text-halo-color': '#000',\n        'text-halo-width': 1.5,\n      },\n    }, 'rainclouds');\n\n    map.addLayer({\n      id: 'rainreadings',\n      type: 'symbol',\n      source: 'observations',\n      minzoom: 11,\n      tolerance: 1,\n      buffer: 0,\n      filter: ['all', ['has', 'rain_mm'], ['>', 'rain_mm', 0]],\n      layout: {\n        'text-field': '{rain_mm}',\n        'text-size': [\n          'interpolate', ['linear'], ['zoom'],\n          8, ['zoom'],\n          14, ['*', 1.1, ['zoom']]\n        ],\n        'text-ignore-placement': true,\n        'text-offset': [0, 1.1],\n        'text-padding': 0,\n      },\n      paint: {\n        'text-color': 'aqua',\n        'text-halo-color': '#000',\n        'text-halo-width': 1.5,\n      },\n    }, 'rainclouds');\n  });\n\n  rafInterval(showRain, 60 * 1000); // every min\n  rafInterval(showObservations, 2 * 60 * 1000); // every 2 mins\n\n  // Mask the area outside Singapore\n  map.addLayer({\n    id: 'bbox',\n    type: 'fill',\n    tolerance: 1,\n    buffer: 0,\n    source: {\n      type: 'geojson',\n      data: {\n        type: 'Feature',\n        properties: {},\n        geometry: {\n          type: 'Polygon',\n          coordinates: [[\n            [-180, 90], [180, 90], [180, -90], [-180, -90], [-180, 90]\n          ], [\n            [lowerLong, upperLat],\n            [upperLong, upperLat],\n            [upperLong, lowerLat],\n            [lowerLong, lowerLat],\n            [lowerLong, upperLat]\n          ]],\n        },\n      },\n    },\n    paint: {\n      'fill-color': 'rgba(0,0,0,.5)',\n      'fill-antialias': false,\n    },\n  }, labelLayerId);\n});\n\n// https://stackoverflow.com/a/21829819/20838\n// http://w3c.github.io/deviceorientation/spec-source-orientation.html#worked-example\nconst degtorad = Math.PI / 180; // Degree-to-Radian conversion\nfunction compassHeading(alpha, beta, gamma){\n  var _x = beta  ? beta  * degtorad : 0; // beta value\n  var _y = gamma ? gamma * degtorad : 0; // gamma value\n  var _z = alpha ? alpha * degtorad : 0; // alpha value\n\n  var cX = Math.cos( _x );\n  var cY = Math.cos( _y );\n  var cZ = Math.cos( _z );\n  var sX = Math.sin( _x );\n  var sY = Math.sin( _y );\n  var sZ = Math.sin( _z );\n\n  // Calculate Vx and Vy components\n  var Vx = - cZ * sY - sZ * sX * cY;\n  var Vy = - sZ * sY + cZ * sX * cY;\n\n  // Calculate compass heading\n  var compassHeading = Math.atan( Vx / Vy );\n\n  // Convert compass heading to use whole unit circle\n  if( Vy < 0 ) {\n    compassHeading += Math.PI;\n  } else if( Vx < 0 ) {\n    compassHeading += 2 * Math.PI;\n  }\n\n  return compassHeading * ( 180 / Math.PI ); // Compass Heading (in degrees)\n}\n\nconst $windCompasss = document.getElementById('wind-compass');\nif (window.DeviceOrientationEvent){\n  // https://developers.google.com/web/updates/2016/03/device-orientation-changes\n  // https://stackoverflow.com/a/47870694/20838\n  var deviceorientation = 'ondeviceorientationabsolute' in window ? 'deviceorientationabsolute' : 'deviceorientation';\n  window.addEventListener(deviceorientation, function(e){\n    if (!e || e.alpha === null) return;\n    const heading = e.compassHeading || e.webkitCompassHeading || compassHeading(e.alpha, e.beta, e.gamma);\n    $windCompasss.classList.add('compassing');\n    $windCompasss.style.transform = `rotate(${heading-180}deg)`;\n  }, false);\n}\n\nif ('serviceWorker' in navigator){\n  window.addEventListener('load', function(){\n    navigator.serviceWorker.register('./sw.js');\n  });\n}\n\nconst isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') !== -1;\nif (isSafari){\n  setTimeout(function(){\n    const ratio = window.devicePixelRatio;\n    const canvas = document.createElement('canvas');\n    const w = canvas.width = window.screen.width * ratio;\n    const h = canvas.height = window.screen.height * ratio;\n    const ctx = canvas.getContext('2d');\n    ctx.fillStyle = '#343332';\n    ctx.fillRect(0, 0, w, h);\n    const icon = new Image();\n    icon.onload = () => {\n      const aspectRatio = icon.width / icon.height;\n      icon.width = w/2;\n      icon.height = w/2/aspectRatio;\n      ctx.drawImage(icon, (w - icon.width)/2, (h - icon.height)/2, icon.width, icon.height);\n      document.head.insertAdjacentHTML('beforeend', `<link rel=\"apple-touch-startup-image\" href=\"${canvas.toDataURL()}\">`);\n    };\n    icon.src = iconSVGPath;\n  }, 5000);\n}"]}