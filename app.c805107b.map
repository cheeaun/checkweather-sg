{"version":3,"sources":["raining-sg/node_modules/new-point-haversine/haversine.js","app.js"],"names":["center","getLatitudeBounds","lowerLat","upperLat","getLongitudeBounds","lowerLong","upperLong","mapboxgl","accessToken","window","$map","remove","map","Map","container","maxBounds","style","logoPosition","maxZoom","renderWorldCopies","boxZoom","attributionControl","sgCenter","setCenter","addControl","AttributionControl","compact","NavigationControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","PitchControl","_map","document","createElement","className","innerHTML","onclick","pitch","getPitch","nextPitch","easeTo","on","onPitch","bind","_container","classList","toggle","text","getElementsByTagName","transform","parentNode","removeChild","off","undefined","cloudsMode","CloudsModeControl","body","setLayoutProperty","$legend","getElementById","add","uniqMinute","Math","floor","Date","getMinutes","stationsMap","genReadingsGeoJSON","data","metadata","stations","forEach","station","id","location","latitude","longitude","type","features","items","readings","properties","reading","value","geometry","coordinates","station_id","um","sources","rain","rainfall","temp","humid","wind","showRain","newUM","console","log","rainSource","getSource","setData","fetch","then","r","json","catch","_","addSource","addLayer","source","paint","labelLayerId","layout","visibility","currentPitch","rainfallData","filter","showWeather","hasWeatherSource","Promise","all","responses","tempData","humidData","windData","minzoom","loadImage","e","image","addImage","sdf","rafInterval","fn","delay","rafint","start","requestAnimationFrame","fnTimeout","stop","clearTimeout","setTimeout","layers","getStyle","i","length","degtorad","PI","compassHeading","alpha","beta","gamma","_x","_y","_z","cX","cos","cY","cZ","sX","sin","sY","sZ","Vx","Vy","atan","$windCompasss","DeviceOrientationEvent","deviceorientation","addEventListener","heading","webkitCompassHeading"],"mappings":"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","file":"app.c805107b.map","sourcesContent":["const cos = Math.cos;\nconst sin = Math.sin;\nconst sqrt = Math.sqrt;\nconst PI = Math.PI;\n\n// Earth radius in diff metrics\nconst radii = {\n\tkm:    6371,\n\tmile:  3960,\n\tmeter: 6371000,\n\tnmi:   3440\n};\n\nconst haversine = {\n\n\tgetLatitudeBounds(lat, d, metric) {\n\t\tif (!metric) {\n\t\t\tmetric = \"meter\";\n\t\t}\n\t\t(arguments.length === 0) && (() => { throw new Error('Please fill in all arguments'); })();\t\t\n\t\tlet metricPerDeg = (2*PI/360) * radii[metric];\n\t\tlet degChange = d/metricPerDeg;\n\t\treturn {\n\t\t\tlowerLat: lat - degChange,\n\t\t\tupperLat: lat + degChange\n\t\t};\n\t}, \n\tgetLongitudeBounds(lat, long, d, metric) {\n\t\tif (!metric) {\n\t\t\tmetric = \"meter\";\n\t\t}\n\t\t(arguments.length === 0) && (() => { throw new Error('Please fill in all arguments'); })();\n\t\tlet metricPerDeg = (2*PI/360) * radii[metric] * cos(lat * PI/180);\n\t\tlet degChange = d/metricPerDeg;\n\t\treturn {\n\t\t\tlowerLong: long - degChange,\n\t\t\tupperLong: long + degChange\n\t\t};\n\t}\t\n};\n\nmodule.exports = haversine;","import arrowPath from './assets/arrow-down.png';\nimport haversine from 'new-point-haversine';\n\nconst center = [103.972583, 1.349110];\nconst { lowerLat, upperLat } = haversine.getLatitudeBounds(center[1], 70, 'km');\nconst { lowerLong, upperLong } = haversine.getLongitudeBounds(center[1], center[0], 70, 'km');\n\nmapboxgl.accessToken = 'pk.eyJ1IjoiY2hlZWF1biIsImEiOiIwMTkyNjRiOWUzOTMyZThkYTE3YjMyMWFiZGU2OTZlNiJ9.XsOEKtyctGiNGNsmVhetYg';\nif (window.$map) window.$map.remove();\nconst map = window.$map = new mapboxgl.Map({\n  container: 'map',\n  maxBounds: [lowerLong, lowerLat, upperLong, upperLat], // w,s,e,n\n  style: 'mapbox://styles/mapbox/dark-v9?optimize=true',\n  logoPosition: 'top-right',\n  maxZoom: 14,\n  renderWorldCopies: false,\n  boxZoom: false,\n  attributionControl: false,\n});\nconst sgCenter = [103.821842, 1.349139];\nmap.setCenter(sgCenter);\n\n// Controls\nmap.addControl(new mapboxgl.AttributionControl({\n  compact: true\n}), 'top-right');\nmap.addControl(new mapboxgl.NavigationControl(), 'top-right');\nmap.addControl(new mapboxgl.GeolocateControl({\n  positionOptions: {\n    enableHighAccuracy: true,\n  },\n  trackUserLocation: true,\n}));\n\n// Pitch control\nclass PitchControl {\n  onAdd(map) {\n    this._map = map;\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n    container.innerHTML = '<button class=\"mapboxgl-ctrl-icon mapboxgl-ctrl-custom-pitch\" type=\"button\"><span>3D</span></button>';\n    container.onclick = function(){\n      var pitch = map.getPitch();\n      var nextPitch = 0;\n      if (pitch < 30) {\n        nextPitch = 30;\n      } else if (pitch < 45) {\n        nextPitch = 45;\n      } else if (pitch < 60) {\n        nextPitch = 60;\n      }\n      map.easeTo({ pitch: nextPitch });\n    };\n    map.on('pitchend', this.onPitch.bind(this));\n    this._container = container;\n    return this._container;\n  }\n  onPitch() {\n    const pitch = this._map.getPitch();\n    this._container.classList.toggle('active', !!pitch);\n    const text = this._container.getElementsByTagName('span')[0];\n    text.style.transform = 'rotate3d(1,0,0,' + pitch + 'deg)';\n  }\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map.off('pitchend', this.onPitch.bind(this));\n    this._map = undefined;\n  }\n};\nmap.addControl(new PitchControl(), 'top-right');\n\n// Clouds Mode control\nlet cloudsMode = false;\nclass CloudsModeControl {\n  onAdd(map) {\n    this._map = map;\n    const container = document.createElement('div');\n    container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\n    container.innerHTML = `<button class=\"mapboxgl-ctrl-icon mapboxgl-ctrl-custom-clouds-mode\" type=\"button\">\n      <svg viewBox=\"0 0 640 512\">\n        <path d=\"M537.585 226.56C541.725 215.836 544 204.184 544 192c0-53.019-42.981-96-96-96-19.729 0-38.065 5.954-53.316 16.159C367.042 64.248 315.288 32 256 32c-88.366 0-160 71.634-160 160 0 2.728.07 5.439.204 8.133C40.171 219.845 0 273.227 0 336c0 79.529 64.471 144 144 144h368c70.692 0 128-57.308 128-128 0-61.93-43.983-113.586-102.415-125.44z\"/>\n      </svg>\n    </button>`;\n    container.onclick = function(){\n      cloudsMode = !cloudsMode;\n      container.classList.toggle('active', cloudsMode);\n      document.body.classList.toggle('cloud-mode', cloudsMode);\n      if (cloudsMode){\n        map.setLayoutProperty('rain3d', 'visibility', 'none');\n        map.setLayoutProperty('rainlay', 'visibility', 'none');\n        map.setLayoutProperty('rainclouds', 'visibility', 'visible');\n        map.setLayoutProperty('raincloudshadows', 'visibility', 'visible');\n        map.easeTo({\n          pitch: 60,\n        });\n      } else {\n        const pitch = map.getPitch();\n        map.setLayoutProperty('rain3d', 'visibility', pitch > 0 ? 'visible' : 'none');\n        map.setLayoutProperty('rainlay', 'visibility', pitch > 0 ? 'none' : 'visible');\n        map.setLayoutProperty('rainclouds', 'visibility', 'none');\n        map.setLayoutProperty('raincloudshadows', 'visibility', 'none');\n      }\n    };\n    this._container = container;\n    return this._container;\n  }\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n  }\n}\nmap.addControl(new CloudsModeControl(), 'top-right');\n\n// Fade out the legend when interacting on the map\nconst $legend = document.getElementById('legend');\nmap.on('movestart', () => $legend.classList.add('faded'));\nmap.on('moveend', () => $legend.classList.remove('faded'));\n\nconst uniqMinute = () => {\n  return Math.floor((new Date()).getMinutes()/5)*5;\n};\n\nconst stationsMap = {};\nconst genReadingsGeoJSON = (data) => {\n  data.metadata.stations.forEach(station => {\n    if (stationsMap[station.id]) return;\n    const { latitude, longitude } = station.location;\n    stationsMap[station.id] = [longitude, latitude];\n  });\n  return {\n    type: 'FeatureCollection',\n    features: data.items[0].readings.map(reading => {\n      return {\n        type: 'Feature',\n        properties: {\n          reading: reading.value,\n        },\n        geometry: {\n          type: 'Point',\n          coordinates: stationsMap[reading.station_id],\n        },\n      }\n    }),\n  };\n}\n\nlet um;\nconst sources = {\n  rain: 'https://api.checkweather.sg/now',\n  rainfall: 'https://api.data.gov.sg/v1/environment/rainfall',\n  temp: 'https://api.data.gov.sg/v1/environment/air-temperature',\n  humid: 'https://api.data.gov.sg/v1/environment/relative-humidity',\n  wind: 'https://api.data.gov.sg/v1/environment/wind-direction',\n};\n\nconst showRain = () => {\n  const newUM = uniqMinute();\n  if (um === newUM) return;\n  um = newUM;\n  console.log('UM', um);\n\n  const rainSource = map.getSource('rainsource');\n  if (rainSource){\n    rainSource.setData(sources.rain);\n    fetch(sources.rainfall)\n      .then(r => r.json())\n      .then(data => {\n        map.getSource('rainmm').setData(genReadingsGeoJSON(data));\n      })\n      .catch(_=>_);\n  } else {\n    map.addSource('rainsource', {\n      type: 'geojson',\n      data: sources.rain,\n    });\n\n    // 2D radar\n    map.addLayer({\n      id: 'rainlay',\n      type: 'fill',\n      source: 'rainsource',\n      paint: {\n        'fill-color': ['get', 'color'],\n        'fill-antialias': false,\n        // 'fill-outline-color': 'black',\n        'fill-opacity': [\n          'interpolate', ['linear'], ['zoom'],\n          8, .9,\n          14, ['*', ['/', ['get', 'intensity'], 100], .3]\n        ],\n      },\n    }, labelLayerId);\n\n    // 3D radar\n    map.addLayer({\n      id: 'rain3d',\n      type: 'fill-extrusion',\n      source: 'rainsource',\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-extrusion-color': ['get', 'color'],\n        'fill-extrusion-opacity': [\n          'interpolate', ['linear'], ['zoom'],\n          8, .9,\n          14, .1\n        ],\n        'fill-extrusion-height': ['*', 50, ['get', 'intensity']],\n      },\n    }, labelLayerId);\n\n    // 3D clouds\n    map.addLayer({\n      id: 'rainclouds',\n      type: 'fill-extrusion',\n      source: 'rainsource',\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-extrusion-color': '#fff',\n        'fill-extrusion-opacity': .8,\n        'fill-extrusion-height': ['+', 5200, ['*', 5, ['get', 'intensity']]],\n        'fill-extrusion-base': 5000,\n      },\n    });\n    map.addLayer({\n      id: 'raincloudshadows',\n      type: 'fill',\n      source: 'rainsource',\n      layout: {\n        visibility: 'none',\n      },\n      paint: {\n        'fill-antialias': false,\n        'fill-opacity': [\n          'interpolate', ['linear'], ['zoom'],\n          8, 1,\n          14, ['/', ['get', 'intensity'], 100]\n        ],\n      },\n    });\n\n    let currentPitch = -1;\n    map.on('pitchend', () => {\n      const pitch = map.getPitch();\n      if (pitch === currentPitch) return;\n      currentPitch = pitch;\n      if (cloudsMode) return;\n      map.setLayoutProperty('rain3d', 'visibility', pitch > 0 ? 'visible' : 'none');\n      map.setLayoutProperty('rainlay', 'visibility', pitch > 0 ? 'none' : 'visible');\n    });\n\n    fetch(sources.rainfall)\n    .then(r => r.json())\n    .then((rainfallData) => {\n      map.addSource('rainmm', {\n        type: 'geojson',\n        data: genReadingsGeoJSON(rainfallData),\n      });\n      map.addLayer({\n        id: 'rainreadings',\n        type: 'symbol',\n        source: 'rainmm',\n        filter: ['!=', 'reading', 0],\n        layout: {\n          'text-field': '{reading}',\n          'text-size': [\n            'interpolate', ['linear'], ['zoom'],\n            8, ['zoom'],\n            14, ['*', 1.5, ['zoom']]\n          ],\n        },\n        paint: {\n          'text-color': 'aqua',\n          'text-halo-color': '#000',\n          'text-halo-width': 1,\n        },\n      }, 'rainclouds');\n    });\n  }\n};\n\nconst showWeather = () => {\n  const hasWeatherSource = map.getSource('temp');\n  if (hasWeatherSource){\n    Promise.all([\n      fetch(sources.temp),\n      fetch(sources.humid),\n      fetch(sources.wind)\n    ])\n    .then((responses) => Promise.all(responses.map(r => r.json())))\n    .then(([tempData, humidData, windData]) => {\n      map.getSource('temp').setData(genReadingsGeoJSON(tempData));\n      map.getSource('humid').setData(genReadingsGeoJSON(humidData));\n      map.getSource('wind').setData(genReadingsGeoJSON(windData));\n    })\n    .catch(_=>_);\n  } else {\n    Promise.all([\n      fetch(sources.temp),\n      fetch(sources.humid),\n      fetch(sources.wind)\n    ])\n    .then((responses) => Promise.all(responses.map(r => r.json())))\n    .then(([tempData, humidData, windData]) => {\n      map.addSource('temp', {\n        type: 'geojson',\n        data: genReadingsGeoJSON(tempData),\n      });\n      map.addLayer({\n        id: 'tempreadings',\n        type: 'symbol',\n        source: 'temp',\n        filter: ['!=', 'reading', 0],\n        layout: {\n          'text-field': '{reading}°',\n          'text-allow-overlap': true,\n          'text-size': [\n            'interpolate', ['linear'], ['zoom'],\n            8, ['zoom'],\n            14, ['*', 1.5, ['zoom']]\n          ],\n          'text-padding': 1,\n        },\n        paint: {\n          'text-color': 'yellow',\n          'text-halo-color': '#000',\n          'text-halo-width': 1,\n        },\n      }, 'rainclouds');\n\n      map.addSource('humid', {\n        type: 'geojson',\n        data: genReadingsGeoJSON(humidData),\n      });\n      map.addLayer({\n        id: 'humidreadings',\n        type: 'symbol',\n        source: 'humid',\n        minzoom: 10,\n        filter: ['!=', 'reading', 0],\n        layout: {\n          'text-field': '{reading}%',\n          'text-size': [\n            'interpolate', ['linear'], ['zoom'],\n            8, ['zoom'],\n            14, ['zoom']\n          ],\n          'text-offset': [0, -1],\n          'text-padding': 0,\n        },\n        paint: {\n          'text-color': 'orange',\n          'text-halo-color': '#000',\n          'text-halo-width': 1,\n        },\n      }, 'rainclouds');\n\n      map.addSource('wind', {\n        type: 'geojson',\n        data: genReadingsGeoJSON(windData),\n      });\n      map.loadImage(arrowPath, (e, image) => {\n        if (e) throw e;\n        map.addImage('arrow', image, { sdf: true });\n        map.addLayer({\n          id: 'windirections',\n          type: 'symbol',\n          source: 'wind',\n          layout: {\n            'icon-image': 'arrow',\n            'icon-rotate': ['get', 'reading'],\n            'icon-allow-overlap': true,\n            'icon-ignore-placement': true,\n            'icon-pitch-alignment': 'map',\n            'icon-rotation-alignment': 'map',\n            'icon-size': [\n              'interpolate', ['linear'], ['zoom'],\n              8, .4,\n              14, 3\n            ],\n          },\n          paint: {\n            'icon-color': '#fff',\n            'icon-opacity': .2,\n          },\n        }, 'tempreadings');\n      });\n    })\n    .catch(_=>_);\n  }\n};\n\nconst rafInterval = (fn, delay) => {\n  let rafint;\n  const start = () => requestAnimationFrame(() => {\n    fn();\n    fnTimeout();\n  });\n  const stop = () => clearTimeout(rafint);\n  const fnTimeout = () => {\n    stop();\n    rafint = setTimeout(start, delay);\n  }\n  return {\n    start,\n    stop,\n  };\n};\n\nlet labelLayerId;\nmap.on('load', function(){\n  const layers = map.getStyle().layers;\n  // Find the index of the first symbol layer in the map style\n  for (let i=0; i<layers.length; i++){\n    if (layers[i].type === 'symbol' && layers[i].layout['text-field']){\n      labelLayerId = layers[i].id;\n      break;\n    }\n  }\n\n  rafInterval(showRain, 2 * 60 * 1000).start(); // every 2 mins\n  rafInterval(showWeather, 60 * 1000).start(); // every min\n});\n\n// https://stackoverflow.com/a/21829819/20838\n// http://w3c.github.io/deviceorientation/spec-source-orientation.html#worked-example\nconst degtorad = Math.PI / 180; // Degree-to-Radian conversion\nfunction compassHeading(alpha, beta, gamma){\n  var _x = beta  ? beta  * degtorad : 0; // beta value\n  var _y = gamma ? gamma * degtorad : 0; // gamma value\n  var _z = alpha ? alpha * degtorad : 0; // alpha value\n\n  var cX = Math.cos( _x );\n  var cY = Math.cos( _y );\n  var cZ = Math.cos( _z );\n  var sX = Math.sin( _x );\n  var sY = Math.sin( _y );\n  var sZ = Math.sin( _z );\n\n  // Calculate Vx and Vy components\n  var Vx = - cZ * sY - sZ * sX * cY;\n  var Vy = - sZ * sY + cZ * sX * cY;\n\n  // Calculate compass heading\n  var compassHeading = Math.atan( Vx / Vy );\n\n  // Convert compass heading to use whole unit circle\n  if( Vy < 0 ) {\n    compassHeading += Math.PI;\n  } else if( Vx < 0 ) {\n    compassHeading += 2 * Math.PI;\n  }\n\n  return compassHeading * ( 180 / Math.PI ); // Compass Heading (in degrees)\n}\n\nconst $windCompasss = document.getElementById('wind-compass');\nif (window.DeviceOrientationEvent){\n  // https://developers.google.com/web/updates/2016/03/device-orientation-changes\n  // https://stackoverflow.com/a/47870694/20838\n  var deviceorientation = 'ondeviceorientationabsolute' in window ? 'deviceorientationabsolute' : 'deviceorientation';\n  window.addEventListener(deviceorientation, function(e){\n    if (!e || e.alpha === null) return;\n    const heading = e.compassHeading || e.webkitCompassHeading || compassHeading(e.alpha, e.beta, e.gamma);\n    $windCompasss.classList.add('compassing');\n    $windCompasss.style.transform = `rotate(${heading-180}deg)`;\n  }, false);\n}"]}