parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({14:[function(require,module,exports) {
module.exports="/arrow-down.70523fd2.png";
},{}],15:[function(require,module,exports) {
module.exports="/rain.ced4ed8c.png";
},{}],7:[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),e=require("./assets/arrow-down.png"),i=a(e),o=require("./assets/rain.png"),n=a(o);function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var l=[103.8475,1.3011],s=1.156,c=1.475,d=103.565,u=104.13;mapboxgl.accessToken="pk.eyJ1IjoiY2hlZWF1biIsImEiOiIwMTkyNjRiOWUzOTMyZThkYTE3YjMyMWFiZGU2OTZlNiJ9.XsOEKtyctGiNGNsmVhetYg",window.$map&&window.$map.remove();var p=window.$map=new mapboxgl.Map({container:"map",center:l,style:"mapbox://styles/mapbox/dark-v9?optimize=true",logoPosition:"top-right",minZoom:8,maxZoom:14,renderWorldCopies:!1,boxZoom:!1,attributionControl:!1});p.fitBounds([d,s,u,c],{animate:!1,padding:window.innerWidth>480&&window.innerHeight>480?120:0}),p.addControl(new mapboxgl.AttributionControl({compact:!0}),"top-right"),p.addControl(new mapboxgl.NavigationControl,"top-right"),p.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}));var y=function(){function e(){r(this,e)}return t(e,[{key:"onAdd",value:function(t){this._map=t;var e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group",e.innerHTML='<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-custom-pitch" type="button"><span>3D</span></button>',e.onclick=function(){var e=t.getPitch(),i=0;e<30?i=30:e<45?i=45:e<60&&(i=60),t.easeTo({pitch:i})},t.on("pitchend",this.onPitch.bind(this)),this._container=e,this._container}},{key:"onPitch",value:function(){var t=this._map.getPitch();this._container.classList.toggle("active",!!t),this._container.getElementsByTagName("span")[0].style.transform="rotate3d(1,0,0,"+t+"deg)"}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map.off("pitchend",this.onPitch.bind(this)),this._map=void 0}}]),e}();p.addControl(new y,"top-right");var m=!1,f=function(){function e(){r(this,e)}return t(e,[{key:"onAdd",value:function(t){this._map=t;var e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group",e.innerHTML='<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-custom-clouds-mode" type="button">\n      <svg viewBox="0 0 640 512">\n        <path d="M537.585 226.56C541.725 215.836 544 204.184 544 192c0-53.019-42.981-96-96-96-19.729 0-38.065 5.954-53.316 16.159C367.042 64.248 315.288 32 256 32c-88.366 0-160 71.634-160 160 0 2.728.07 5.439.204 8.133C40.171 219.845 0 273.227 0 336c0 79.529 64.471 144 144 144h368c70.692 0 128-57.308 128-128 0-61.93-43.983-113.586-102.415-125.44z"/>\n      </svg>\n    </button>',e.onclick=function(){if(m=!m,e.classList.toggle("active",m),document.body.classList.toggle("cloud-mode",m),m)t.setLayoutProperty("rain3d","visibility","none"),t.setLayoutProperty("rainlay","visibility","none"),t.setLayoutProperty("rainclouds","visibility","visible"),t.setLayoutProperty("raindrops","visibility","visible"),t.setLayoutProperty("raincloudshadows","visibility","visible"),t.easeTo({pitch:60});else{var i=t.getPitch();t.setLayoutProperty("rain3d","visibility",i>0?"visible":"none"),t.setLayoutProperty("rainlay","visibility",i>0?"none":"visible"),t.setLayoutProperty("rainclouds","visibility","none"),t.setLayoutProperty("raindrops","visibility","none"),t.setLayoutProperty("raincloudshadows","visibility","none")}},this._container=e,this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}}]),e}();p.addControl(new f,"top-right");var h=document.getElementById("legend");p.on("movestart",function(){return h.classList.add("faded")}),p.on("moveend",function(){return h.classList.remove("faded")});var g=function(){return 5*Math.floor((new Date).getMinutes()/5)},v={},b=function(t){return t.metadata.stations.forEach(function(t){if(!v[t.id]){var e=t.location,i=e.latitude,o=e.longitude;v[t.id]=[o,i]}}),{type:"FeatureCollection",features:t.items[0].readings.map(function(t){return{type:"Feature",properties:{reading:t.value},geometry:{type:"Point",coordinates:v[t.station_id]}}})}},x="https://api.checkweather.sg",w={rain:x+"/now",id:x+"/now-id",observations:x+"/observations?compact=1"},L=document.getElementById("datetime"),P=document.getElementById("loader");p.on("dataloading",function(t){P.hidden=!1,L.hidden=!0});var _=null;p.on("data",function(t){clearTimeout(_),_=setTimeout(function(){P.hidden=!0,L.hidden=!1},1e3)});var M=function(){var t=p.getSource("rainsource");if(t)t.setData(w.rain);else{p.addSource("rainsource",{type:"geojson",data:w.rain}),p.addLayer({id:"rainlay",type:"fill",source:"rainsource",paint:{"fill-color":["get","color"],"fill-antialias":!1,"fill-opacity":["interpolate",["linear"],["zoom"],8,["max",.5,["*",["/",["get","intensity"],100],1]],14,["max",.1,["*",["/",["get","intensity"],100],.5]]]}},"water"),p.addLayer({id:"rain3d",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],8,.7,14,.1],"fill-extrusion-height":["*",50,["get","intensity"]]}},"water"),p.addLayer({id:"rainclouds",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-color":"#fff","fill-extrusion-opacity":.8,"fill-extrusion-height":["+",5200,["*",5,["get","intensity"]]],"fill-extrusion-base":5e3}}),p.loadImage(n.default,function(t,e){if(t)throw t;p.addImage("rain",e),p.addLayer({id:"raindrops",type:"fill-extrusion",source:"rainsource",layout:{visibility:"none"},paint:{"fill-extrusion-pattern":"rain","fill-extrusion-height":5e3,"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],12,.2,14,.03]}},"rainclouds"),p.addLayer({id:"raincloudshadows",type:"fill",source:"rainsource",layout:{visibility:"none"},paint:{"fill-antialias":!1,"fill-opacity":["interpolate",["linear"],["zoom"],8,.5,14,["*",["/",["get","intensity"],100],.5]]}},"raindrops")});var e=-1;p.on("pitchend",function(){var t=p.getPitch();t!==e&&(e=t,m||(p.setLayoutProperty("rain3d","visibility",t>0?"visible":"none"),p.setLayoutProperty("rainlay","visibility",t>0?"none":"visible")))})}setTimeout(function(){fetch(w.id).then(function(t){return t.text()}).then(function(t){var e=(t.match(/\d{4}$/)||[""])[0].replace(/(\d{2})(\d{2})/,function(t,e,i){var o=parseInt(e,10),n=o>=12?"PM":"AM";return 0==o&&(o=12),o>12&&(o-=12),o+"<blink>:</blink>"+i+" "+n});L.innerHTML=e})},1e3)},z=function(){var t=p.getSource("observations");t?t.setData(w.observations):(p.addSource("observations",{type:"geojson",data:w.observations}),p.addLayer({id:"tempreadings",type:"symbol",source:"observations",filter:["all",["has","temp_celcius"],[">","temp_celcius",0]],layout:{"text-field":"{temp_celcius}Â°","text-allow-overlap":!0,"text-ignore-placement":!0,"text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["*",1.5,["zoom"]]],"text-padding":1},paint:{"text-color":"yellow","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),p.addLayer({id:"humidreadings",type:"symbol",source:"observations",minzoom:9,filter:["all",["has","relative_humidity"],[">","relative_humidity",0]],layout:{"text-field":"{relative_humidity}%","text-ignore-placement":!0,"text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["zoom"]],"text-offset":[0,-1.1],"text-padding":0},paint:{"text-color":"orange","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),p.addLayer({id:"rainreadings",type:"symbol",source:"observations",minzoom:11,filter:["all",["has","rain_mm"],[">","rain_mm",0]],layout:{"text-field":"{rain_mm}","text-size":["interpolate",["linear"],["zoom"],8,["zoom"],14,["zoom"]],"text-ignore-placement":!0,"text-offset":[0,1.1],"text-padding":0},paint:{"text-color":"aqua","text-halo-color":"#000","text-halo-width":1}},"rainclouds"),p.loadImage(i.default,function(t,e){t||(p.addImage("arrow",e,{sdf:!0}),setTimeout(function(){p.addLayer({id:"windirections",type:"symbol",source:"observations",filter:["has","wind_direction"],layout:{"icon-image":"arrow","icon-rotate":["get","wind_direction"],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-pitch-alignment":"map","icon-rotation-alignment":"map","icon-size":["interpolate",["linear"],["zoom"],8,.4,14,3]},paint:{"icon-color":"#fff","icon-opacity":.3}},"tempreadings")},300))}))},T=function(t,e){var i=void 0,o=function(){return requestAnimationFrame(function(){t(),a()})},n=function(){return clearTimeout(i)},a=function(){n(),i=setTimeout(o,e)};return{start:o,stop:n}},k=void 0;p.on("load",function(){for(var t=p.getStyle().layers,e=0;e<t.length;e++)if("symbol"===t[e].type&&t[e].layout["text-field"]){k=t[e].id;break}p.moveLayer("water",k),p.setPaintProperty("water","fill-opacity",.5),setTimeout(function(){p.getStyle().layers.forEach(function(t){if("symbol"===t.type&&t.layout["text-field"]&&/place\-city/i.test(t.id)){var e=p.getPaintProperty(t.id,"text-opacity");(!e||e>.5)&&p.setPaintProperty(t.id,"text-opacity",.5)}})},2e3),p.addLayer({id:"bbox",type:"fill",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-180,90],[180,90],[180,-90],[-180,-90],[-180,90]],[[d,c],[u,c],[u,s],[d,s],[d,c]]]}}},paint:{"fill-color":"rgba(0,0,0,.5)"}},k),T(M,6e4).start(),T(z,12e4).start()});var C=Math.PI/180;function I(t,e,i){var o=e?e*C:0,n=i?i*C:0,a=t?t*C:0,r=(Math.cos(o),Math.cos(n)),l=Math.cos(a),s=Math.sin(o),c=Math.sin(n),d=Math.sin(a),u=-l*c-d*s*r,p=-d*c+l*s*r,y=Math.atan(u/p);return p<0?y+=Math.PI:u<0&&(y+=2*Math.PI),y*(180/Math.PI)}var E=document.getElementById("wind-compass");if(window.DeviceOrientationEvent){var N="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(N,function(t){if(t&&null!==t.alpha){var e=t.compassHeading||t.webkitCompassHeading||I(t.alpha,t.beta,t.gamma);E.classList.add("compassing"),E.style.transform="rotate("+(e-180)+"deg)"}},!1)}
},{"./assets/arrow-down.png":14,"./assets/rain.png":15}]},{},[7], null)
//# sourceMappingURL=/app.11d801f7.map