function t(){import.meta.url,import("_").catch((()=>1)),async function*(){}().next()}import{i as e,g as o,p as n,$ as a,c as i,q as r,l as s,o as l,a as c,E as d,u as h,r as p,d as u,b as m,y as g,e as y,f,h as v,j as x}from"./vendor-DRXKBxai.js";import{m as w}from"./maplibre-gl-DGXC28gF.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const o of t)if("childList"===o.type)for(const t of o.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();function b(t,e,o){return[[t[0]*(1-o)+e[0]*o,t[1]*(1-o)+e[1]*o],[t[0]*o+e[0]*(1-o),t[1]*o+e[1]*(1-o)]]}function F(t,e=1,o=!0,n=.25){if(e>10&&(e=10),0==e)return t;if(o){const a=t.length,i=[];for(let e=0;e<a;e++){const o=t[e],r=t[(e+1)%a],[s,l]=b(o,r,n);i.push(s,l)}return F(i,e-1,o,n)}n>.5&&(n=1-n);for(let a=0;a<e;a++){let e=[];e.push(t[0]);for(let o=1;o<t.length;o++){let a=b(t[o-1],t[o],n);e=e.concat(a)}o?e=e.concat(b(t[t.length-1],t[0],n)):e.push(t[t.length-1]),t=e}return t}const{VITE_MAPTILER_KEY:M}={LEGACY:!1,VITE_MAPTILER_KEY:"fRcAT46aniv3RwvKVv5C"},E=o(e({projectId:"check-weather-sg"})),P=217,_=1.156,B=1.475,C=103.565,z=104.13,D=Math.abs(.5649999999999977),A=Math.abs(B-_),L=n([[[-180,90],[180,90],[180,-90],[-180,-90],[-180,90]],[[C,B],[z,B],[z,_],[C,_],[C,B]]]),I=["#40FFFD","#3BEEEC","#32D0D2","#2CB9BD","#229698","#1C827D","#1B8742","#229F44","#27B240","#2CC53B","#30D43E","#38EF46","#3BFB49","#59FA61","#FEFB63","#FDFA53","#FDEB50","#FDD74A","#FCC344","#FAB03F","#FAA23D","#FB8938","#FB7133","#F94C2D","#F9282A","#DD1423","#BE0F1D","#B21867","#D028A6","#F93DF5"],S=I.length,R={type:"Polygon",coordinates:[[[103.56983184814452,1.1984523335134731],[103.71986389160156,1.1459349466540576],[104.13459777832031,1.2763684180848154],[104.0789794921875,1.3580576343735706],[104.09442901611328,1.3913503559342686],[104.08344268798828,1.4260154737416286],[104.04155731201172,1.4462651532861726],[103.97151947021484,1.4229265238497912],[103.9368438720703,1.4304772829308758],[103.89667510986328,1.4263586901405338],[103.86817932128906,1.4555318956783565],[103.81153106689452,1.4788701887242242],[103.75968933105469,1.4469515799492016],[103.72535705566406,1.4596504356431457],[103.67523193359375,1.4308204986633148],[103.65943908691406,1.4067952740787528],[103.61721038818358,1.323391529857783],[103.56983184814452,1.1984523335134731]]]};window.$map&&window.$map.remove();const T=[C,_,z,B],k=()=>({padding:window.innerWidth>640&&window.innerHeight>640?120:0}),j=window.$map=new w.Map({container:"map",center:[103.8475,1.3011],style:"https://api.maptiler.com/maps/aecd4cb7-a35b-4c10-89aa-0f4bd52ed1cb/style.json?key=".concat(M),minZoom:8,maxZoom:14,renderWorldCopies:!1,boxZoom:!1,pitchWithRotate:!1,dragRotate:!1,touchPitch:!1,attributionControl:!1,bounds:T,fitBoundsOptions:k()});j.touchZoomRotate.disableRotation(),j.addControl(new w.NavigationControl({showCompass:!1}),"top-right"),j.addControl(new w.GeolocateControl({trackUserLocation:!0}),"top-right");j.addControl(new class{onAdd(t){this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group";const e=document.createElement("button");return e.type="button",e.title="Snap to boundary",e.innerHTML='<svg height="100%" width="100%" viewBox="0 0 24 24" fill="#333"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"/></svg>',e.onclick=e=>{e.preventDefault(),this._container.hidden=!0,t.fitBounds(T,k(),{snap:!0})},this._container.appendChild(e),this._container.hidden=!0,t.on("moveend",(t=>{t.snap||(this._container.hidden=!1)})),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}},"top-right");const N=document.getElementById("loader");j.on("dataloading",(t=>{N.hidden=!1}));let V=null;j.on("data",(t=>{clearTimeout(V),V=setTimeout((()=>{N.hidden=!0}),500)}));const H=document.getElementById("legend"),q=document.getElementById("info-button"),O=document.getElementById("legend-close");q.onclick=t=>{t.preventDefault(),H.hidden=!H.hidden},O.onclick=t=>{t.preventDefault(),H.hidden=!0};const $=a((t=>(t.match(/\d{4}$/)||[""])[0].replace(/(\d{2})(\d{2})/,((t,e,o)=>{let n=parseInt(e,10);const a=n>=12?"PM":"AM";return 0==n&&(n=12),n>12&&(n-=12),n+":"+o+" "+a})))),K=a((t=>p(C+t/P*D,4))),U=a((t=>p(B-t/120*A,4))),Z=new Array(26040).fill(0),W=a(((t,e)=>{const o=e.trimEnd().split(/\n/g),n=Z.slice();for(let a=0,i=o.length;a<i;a++){const t=o[a];for(let e=t.search(/[^\s]/),o=t.length;e<o;e++){const o=t[e];if(o&&" "!==o){const t=o.charCodeAt()-33;n[a*P+e]=t}}}return n}),{maxArgs:1}),Y=i().size([P,120]).thresholds([4,10,20,30,40,50,60,70,80,85,90,95,97.5]).smooth(!1),G=a(((t,e)=>{const o=[],n=Y(e);for(let a=0,i=n.length;a<i;a++){const{type:e,value:i,coordinates:r}=n[a];r.length&&o.push({type:"Feature",properties:{intensity:i,id:t},geometry:{type:e,coordinates:r.map((t=>t.map((t=>(t.pop(),F(t).map((([t,e])=>[K(t),U(e)])))))))}})}return o}),{maxArgs:1}),X=a(((t,e,o)=>{const n=[];for(let a=0,i=e.length;a<i;a++)n[a]=(e[a]+o[a])/2;return n}),{maxArgs:1}),J=()=>{fetch("https://api.checkweather.sg/v2/observations").then((t=>t.json())).then((t=>{const e=t.map((t=>{const{id:e,lng:o,lat:n,...a}=t;return f([o,n],a,{id:e})})),o=v(e);j.getSource("observations").setData(o)}))},Q=(t,e,o=!1)=>{o&&t(),setTimeout(requestAnimationFrame,e,(()=>{t(),Q(t,e)}))},tt=({values:t=[],maxValue:e=null,smoothIterations:o=1,style:n={},...a})=>{if(!t.length)return null;const i=t.length-1,r=e||Math.max(...t);let s="";return F(t.map(((t,e)=>[Math.round(e/i*100),Math.round(t/r*100)])),o,!1).forEach(((t,e)=>{e>0&&(s+=","),s+="".concat(t[0],"% ").concat(100-t[1],"%")})),h("div",{...a,style:{...n,clipPath:"polygon(0 100%, ".concat(s,", 100% 100%)")}})};const et=new Promise((t=>{j.once("styledata",t)})),ot=r(c(E,"weather"),l("id","desc"),s(25));let nt=!0,at=!1;d(h((()=>{const[t,e]=u(!1),[o,n]=m(null),[a,i]=m([]),[r,s]=u(!1),[l,c]=u(!1),[d,p]=u(document.hidden);g((()=>{document.addEventListener("visibilitychange",(()=>{p(document.hidden)}),!1)}),[]);const f=function(t,e=1){let o;return function(...n){clearTimeout(o),o=setTimeout((()=>t.call(this,...n)),e)}}((t=>{nt&&console.timeEnd("Fetch Snapshots"),e(!1);const a=t.docs.map((t=>t.data().coverage_percentage.all)).reduce(((t,e)=>t+e))/t.docs.length;console.log({averageCoverage:a}),at=a>25;const r=()=>{console.time("Process Snapshots");const e=[],a=[],r=t.docs.reverse();r.forEach(((t,o)=>{const n=t.data(),i=W(n.id,n.radar),s=G(n.id,i);a.push(...s);const l=r[o+1];if(l&&!at){const t=l.data(),e=W(t.id,t.radar),o="".concat((Number(n.id)+Number(t.id))/2),r=X(o,i,e),s=G(o,r);a.push(...s)}e.push(n)}));const s=v(a);et.then((()=>{j.getFilter("rainradar")||j.setFilter("rainradar",["==","id",t.docs[0].data().id],{validate:!1}),j.getSource("rainradar").setData(s),o||n(e.length),i(e)})),console.timeEnd("Process Snapshots")};if(nt){const e=t.docs[0].data(),o=W(e.id,e.radar),n=G(e.id,o);et.then((()=>{j.getSource("rainradar").setData(v(n)),nt=!1,j.once("idle",(()=>requestAnimationFrame(r)))}))}else r()}),300);g((()=>{let t=()=>{};return d?(s(!1),nt=!1):(console.log("Start Snapshots"),console.time("Fetch Snapshots"),e(!0),t=x(ot,f)),()=>t()}),[d]);const w=a.length;if(w<=1)return null;g((()=>{if(o&&w){const t=Math.round(o),e=.5*Math.round(o/.5);let n=a[t-1].id;if(e!==t&&!at){const t=a[Math.floor(e)-1],o=a[Math.ceil(e)-1];if(t&&o){n="".concat((t.dt+o.dt)/2)}}c(!1),j.setFilter("rainradar",["==","id",n],{validate:!1});const i=o<w-1;j.setPaintProperty("tempreadings","text-opacity",i?.3:1),j.setPaintProperty("humidreadings","text-opacity",i?.3:1),j.setPaintProperty("rainreadings","text-opacity",i?.3:1),j.setPaintProperty("windirections","icon-opacity",i?.1:.3)}}),[o,a]),g((()=>{o<w&&!r&&c(!0)}),[a]);const{id:b}=a[Math.round(o)-1],F=a.map((t=>t.coverage_percentage.sg)),M=Math.max(...F);y((()=>{const t=o>=w;t&&M<5?s(!1):n(t?1:o+.5)}),r?o===w?2e3:100:null);const E=(o-1)/(w-1)*100,P=Math.max(M/100*24,16);return h("div",{id:"player-content",class:t?"loading":"",children:[h("div",{id:"player-button",class:r?"playing":"",onClick:()=>{l?n(w):(o!==w||r||n(1),s(!r))},children:h("div",{id:"player-icon",children:h("svg",{width:P,height:P,viewBox:"0 0 24 24",children:h("path",{d:l?"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z":r?"M6 19h4V5H6v14zm8-14v14h4V5h-4z":"M8 5v14l11-7z"})})})}),h("div",{id:"player-range",children:[h("div",{id:"player-time",class:o===w?"now":"",style:{left:"".concat(E,"%"),transform:"translateX(-".concat(E,"%)")},children:$(b)}),h(tt,{values:F,maxValue:100,smoothIterations:2,style:{height:40},id:"player-sparkline"}),h("progress",{value:o,max:w}),h("div",{id:"player-labels",children:[h("span",{children:$(a[0].id)}),h("span",{children:$(a[Math.round(w/2)-1].id)}),h("span",{children:$(a[w-1].id)})]}),h("input",{type:"range",min:"1",max:w,step:"any",value:o,onInput:t=>{s(!1),n(t.target.value)},onMouseUp:()=>n(Math.round(o)),onTouchEnd:t=>{n(Math.round(o));const e=t.changedTouches[0];if(e){const{width:t,x:o}=e.target.getBoundingClientRect(),a=8,i=t-2*a,r=(e.clientX-a-o)/i*(w-1)+1;n(Math.max(1,Math.min(w,Math.round(r))))}},onTouchCancel:()=>n(Math.round(o))})]})]})}),{}),document.getElementById("player")),(async()=>{await et,j.addSource("observations",{type:"geojson",data:{type:"FeatureCollection",features:[]},tolerance:5,buffer:0,maxzoom:14}),j.addSource("rainradar",{type:"geojson",data:{type:"FeatureCollection",features:[]},maxzoom:14});const t=j.getStyle().layers;let e;for(let i=0;i<t.length;i++){const{id:o,type:n,layout:a}=t[i];if("symbol"===n&&a["text-field"]&&(e||(e=t[i].id)),"symbol"===n){const t=j.getPaintProperty(o,"text-opacity");j.setPaintProperty(o,"text-opacity",["case",["within",R],t||1,0]);const e=j.getPaintProperty(o,"icon-opacity");"number"==typeof e&&j.setPaintProperty(o,"icon-opacity",["case",["within",R],e||1,0])}}const o=["interpolate-lab",["linear"],["number",["get","intensity"],0],0,"transparent",...I.reduce(((t,e,o)=>{const n=(o+1)/S*100;return t.push(n,e),t}),[])],n={"fill-extrusion-color":"#070707","fill-extrusion-opacity":.6,"fill-extrusion-base":100,"fill-extrusion-height":101,"fill-extrusion-vertical-gradient":!1};j.addLayer({id:"water-overlay",type:"fill-extrusion",source:"openmaptiles","source-layer":"water",paint:n},e),j.addLayer({id:"rainradar",type:"fill-extrusion",source:"rainradar",paint:{"fill-extrusion-vertical-gradient":!1,"fill-extrusion-height":["number",["get","intensity"],0],"fill-extrusion-color":o,"fill-extrusion-opacity":["interpolate",["linear"],["zoom"],8,1,12,.15]}},"water-overlay"),j.addLayer({id:"tempreadings",type:"symbol",source:"observations",minzoom:8.5,filter:["all",["has","temp_celcius"],[">","temp_celcius",0]],layout:{"text-field":"{temp_celcius}°","text-allow-overlap":!0,"text-ignore-placement":!0,"text-size":["interpolate",["linear"],["zoom"],8,10,14,28],"text-padding":1,"text-font":["Noto Sans Regular"]},paint:{"text-color":"yellow","text-halo-color":"#000","text-halo-width":1.5}});const a=await j.loadImage("/assets/arrow-down-white-DmoBF-j4.png");j.addImage("arrow",a.data),j.addLayer({id:"windirections",type:"symbol",source:"observations",filter:["has","wind_direction"],layout:{"icon-image":"arrow","icon-rotate":["get","wind_direction"],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-size":["interpolate",["linear"],["zoom"],8,.05,14,.6]},paint:{"icon-opacity":.3}},"tempreadings"),j.addLayer({id:"humidreadings",type:"symbol",source:"observations",minzoom:10,filter:["all",["has","relative_humidity"],[">","relative_humidity",0]],layout:{"text-field":"{relative_humidity}%","text-ignore-placement":!0,"text-size":["interpolate",["linear"],["zoom"],8,8,14,14*1.1],"text-offset":[0,-1.2],"text-padding":0,"text-font":["Noto Sans Regular"]},paint:{"text-color":"orange","text-halo-color":"#000","text-halo-width":1.5}}),j.addLayer({id:"rainreadings",type:"symbol",source:"observations",minzoom:12,filter:["all",["has","rain_mm"],[">","rain_mm",0]],layout:{"text-field":"{rain_mm}mm","text-size":["interpolate",["linear"],["zoom"],8,8,14,14*1.1],"text-ignore-placement":!0,"text-offset":[0,1.2],"text-padding":0,"text-font":["Noto Sans Regular"]},paint:{"text-color":"aqua","text-halo-color":"#000","text-halo-width":1.5}}),Q(J,12e4,!0),j.addLayer({id:"bbox",type:"fill",source:{type:"geojson",tolerance:10,buffer:0,data:L,maxzoom:14},paint:{"fill-color":"rgba(0,0,0,.5)","fill-antialias":!1}},e)})(),et.then((()=>{new URL(window.location.href).searchParams.has("screensaver")&&(document.body.classList.add("screensaver"),j.fitBounds([[C,_],[z,B]]))}));navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")&&setTimeout((function(){const t=window.devicePixelRatio,e=document.createElement("canvas"),o=e.width=window.screen.width*t,n=e.height=window.screen.height*t,a=e.getContext("2d");a.fillStyle="#343332",a.fillRect(0,0,o,n);const i=new Image;i.onload=()=>{const t=i.width/i.height;i.width=o/2,i.height=o/2/t,a.drawImage(i,(o-i.width)/2,(n-i.height)/2,i.width,i.height),document.head.insertAdjacentHTML("beforeend",'<link rel="apple-touch-startup-image" href="'.concat(e.toDataURL(),'">'))},i.src="/assets/icon-standalone-B-rVhTPE.svg"}),5e3);export{t as __vite_legacy_guard};
//# sourceMappingURL=index-Dnt1E6zy.js.map
